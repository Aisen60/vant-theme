import{c as e,g as t,o as a,B as r,t as o,C as l,D as n}from"./use-translate.91889477.js";import{w as s}from"./with-install.c9eedd0e.js";import{u as i}from"./use-refs.6c094865.js";import{u}from"./use-expose.5ea79906.js";import{P as c}from"./index.b58615a3.js";import{B as f}from"./index.60661b5f.js";import{T as d}from"./function-call.470433b8.js";import{g as m}from"./utils.6af751de.js";import{u as p}from"./use-height.ab6478a0.js";import{D as v,z as h,C as g,e as y,x as b,A as w,I as D}from"./vue-libs.71fdcafc.js";import{r as k}from"./utils.b0356070.js";import{o as S}from"./index.94f7437a.js";import{u as x}from"./index.43faf238.js";const[O,T,j]=e("calendar");function C(e,t){const a=e.getFullYear(),r=t.getFullYear();if(a===r){const a=e.getMonth(),r=t.getMonth();return a===r?0:a>r?1:-1}return a>r?1:-1}function M(e,t){const a=C(e,t);if(0===a){const a=e.getDate(),r=t.getDate();return a===r?0:a>r?1:-1}return a}const B=e=>new Date(e),A=e=>Array.isArray(e)?e.map(B):B(e);function R(e,t){const a=B(e);return a.setDate(a.getDate()+t),a}const H=e=>R(e,-1),P=e=>R(e,1),W=()=>{const e=new Date;return e.setHours(0,0,0,0),e};const[I]=e("calendar-day");var N=h({name:I,props:{color:String,index:Number,rowHeight:String,offset:{type:Number,default:0},item:{type:Object,required:!0}},emits:["click"],setup(e,{emit:t,slots:a}){const r=g((()=>{const{item:t,index:a,color:r,offset:o,rowHeight:l}=e,n={height:l};if("placeholder"===t.type)return n.width="100%",n;if(0===a&&(n.marginLeft=100*o/7+"%"),r)switch(t.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":n.background=r;break;case"middle":n.color=r}return n})),o=()=>{"disabled"!==e.item.type&&t("click",e.item)},l=()=>{const{topInfo:t}=e.item;if(t||a["top-info"])return y("div",{class:T("top-info")},[a["top-info"]?a["top-info"](e.item):t])},n=()=>{const{bottomInfo:t}=e.item;if(t||a["bottom-info"])return y("div",{class:T("bottom-info")},[a["bottom-info"]?a["bottom-info"](e.item):t])},s=()=>{const{item:t,color:a,rowHeight:r}=e,{type:o,text:s}=t,i=[l(),s,n()];return"selected"===o?y("div",{class:T("selected-day"),style:{width:r,height:r,background:a}},[i]):i};return()=>{const{type:t,className:a}=e.item;return"placeholder"===t?y("div",{class:T("day"),style:r.value},null):y("div",{role:"gridcell",style:r.value,class:[T("day",t),a],tabindex:"disabled"===t?void 0:-1,onClick:o},[s()])}}});const[F]=e("calendar-month");var Y=h({name:F,props:{type:String,color:String,showMark:Boolean,rowHeight:[Number,String],formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number,date:{type:Date,required:!0},minDate:{type:Date,required:!0},maxDate:{type:Date,required:!0}},emits:["click","update-height"],setup(e,{emit:o,slots:l}){const[n,s]=function(e=!1){var t=v(e);return[t,(e=!t.value)=>{t.value=e}]}(),i=v(),c=v(),f=p(c),d=g((()=>{return t=e.date,j("monthTitle",t.getFullYear(),t.getMonth()+1);var t})),h=g((()=>t(e.rowHeight))),b=g((()=>{const t=e.date.getDay();return e.firstDayOfWeek?(t+7-e.firstDayOfWeek)%7:t})),w=g((()=>m(e.date.getFullYear(),e.date.getMonth()+1))),D=g((()=>n.value||!e.lazyRender)),k=t=>{const{type:a,minDate:r,maxDate:o,currentDate:l}=e;if(M(t,r)<0||M(t,o)>0)return"disabled";if(null===l)return"";if(Array.isArray(l)){if("multiple"===a)return(t=>{const a=t=>e.currentDate.some((e=>0===M(e,t)));if(a(t)){const e=H(t),r=P(t),o=a(e),l=a(r);return o&&l?"multiple-middle":o?"end":l?"start":"multiple-selected"}return""})(t);if("range"===a)return(t=>{const[a,r]=e.currentDate;if(!a)return"";const o=M(t,a);if(!r)return 0===o?"start":"";const l=M(t,r);return e.allowSameDay&&0===o&&0===l?"start-end":0===o?"start":0===l?"end":o>0&&l<0?"middle":""})(t)}else if("single"===a)return 0===M(t,l)?"selected":"";return""},S=t=>{if("range"===e.type){if("start"===t||"end"===t)return j(t);if("start-end"===t)return j("startEnd")}},x=()=>{if(e.showMonthTitle)return y("div",{class:T("month-title")},[d.value])},O=()=>{if(e.showMark&&D.value)return y("div",{class:T("month-mark")},[e.date.getMonth()+1])},C=g((()=>{const e=Math.ceil((w.value+b.value)/7);return Array(e).fill({type:"placeholder"})})),B=g((()=>{const t=[],a=e.date.getFullYear(),r=e.date.getMonth();for(let o=1;o<=w.value;o++){const l=new Date(a,r,o),n=k(l);let s={date:l,type:n,text:o,bottomInfo:S(n)};e.formatter&&(s=e.formatter(s)),t.push(s)}return t})),A=g((()=>B.value.filter((e=>"disabled"===e.type)))),R=(t,r)=>y(N,{item:t,index:r,color:e.color,offset:b.value,rowHeight:h.value,onClick:e=>o("click",e)},a(l,["top-info","bottom-info"]));return u({getTitle:()=>d.value,getHeight:()=>f.value,setVisible:s,scrollIntoView:t=>{const a=e.showSubtitle?i.value:c.value;if(a){const e=a.getBoundingClientRect().top-t.getBoundingClientRect().top+t.scrollTop;r(t,e)}},disabledDays:A}),()=>y("div",{class:T("month"),ref:c},[x(),y("div",{ref:i,role:"grid",class:T("days")},[O(),(D.value?B:C).value.map(R)])])}});const[z]=e("calendar-header");var q=h({name:z,props:{title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["click-subtitle"],setup(e,{slots:t,emit:a}){const r=()=>{if(e.showTitle){const a=e.title||j("title"),r=t.title?t.title():a;return y("div",{class:T("header-title")},[r])}},o=e=>{a("click-subtitle",e)},l=()=>{if(e.showSubtitle){const a=t.subtitle?t.subtitle():e.subtitle;return y("div",{class:T("header-subtitle"),onClick:o},[a])}},n=()=>{const{firstDayOfWeek:t}=e,a=j("weekdays"),r=[...a.slice(t,7),...a.slice(0,t)];return y("div",{class:T("weekdays")},[r.map((e=>y("span",{class:T("weekday")},[e])))])};return()=>y("div",{class:T("header")},[r(),l(),n()])}});const V=s(h({name:O,props:{show:Boolean,title:String,color:String,round:o,readonly:Boolean,poppable:o,teleport:[String,Object],showMark:o,showTitle:o,formatter:Function,rowHeight:[Number,String],confirmText:String,rangePrompt:String,lazyRender:o,showConfirm:o,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:o,closeOnPopstate:o,confirmDisabledText:String,closeOnClickOverlay:o,safeAreaInsetBottom:o,type:{type:String,default:"single"},position:{type:String,default:"bottom"},maxRange:{type:[Number,String],default:null},minDate:{type:Date,validator:l,default:W},maxDate:{type:Date,validator:l,default:()=>{const e=W();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:[Number,String],default:0,validator:e=>e>=0&&e<=6},showRangePrompt:{type:Boolean,default:!0}},emits:["select","confirm","unselect","month-show","over-range","update:show","click-subtitle"],setup(e,{emit:t,slots:r}){const o=(t,a=e.minDate,r=e.maxDate)=>-1===M(t,a)?a:1===M(t,r)?r:t,l=(t=e.defaultDate)=>{const{type:a,minDate:r,maxDate:l}=e;if(null===t)return t;const n=W();if("range"===a){Array.isArray(t)||(t=[]);return[o(t[0]||n,r,H(l)),o(t[1]||n,P(r))]}return"multiple"===a?Array.isArray(t)?t.map((e=>o(e))):[o(n)]:(t&&!Array.isArray(t)||(t=n),o(t))};let s;const m=v(),p=v(""),h=v(l()),[O,I]=i(),N=g((()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0)),F=g((()=>{const t=[],a=new Date(e.minDate);a.setDate(1);do{t.push(new Date(a)),a.setMonth(a.getMonth()+1)}while(1!==C(a,e.maxDate));return t})),z=g((()=>{if(h.value){if("range"===e.type)return!h.value[0]||!h.value[1];if("multiple"===e.type)return!h.value.length}return!h.value})),V=()=>{const e=n(m.value),a=e+s,r=F.value.map(((e,t)=>O.value[t].getHeight()));if(a>r.reduce(((e,t)=>e+t),0)&&e>0)return;let o,l=0;const i=[-1,-1];for(let n=0;n<F.value.length;n++){const s=O.value[n];l<=a&&l+r[n]>=e&&(i[1]=n,o||(o=s,i[0]=n),O.value[n].showed||(O.value[n].showed=!0,t("month-show",{date:s.date,title:s.getTitle()}))),l+=r[n]}F.value.forEach(((e,t)=>{const a=t>=i[0]-1&&t<=i[1]+1;O.value[t].setVisible(a)})),o&&(p.value=o.getTitle())},E=e=>{k((()=>{F.value.some(((t,a)=>0===C(t,e)&&(m.value&&O.value[a].scrollIntoView(m.value),!0))),V()}))},L=()=>{if(!e.poppable||e.show)if(h.value){const t="single"===e.type?h.value:h.value[0];E(t)}else k(V)},U=()=>{e.poppable&&!e.show||k((()=>{s=Math.floor(x(m).height),L()}))},G=(e=l())=>{h.value=e,L()},J=()=>{var e;return t("confirm",null!=(e=h.value)?e:A(h.value))},K=(a,r)=>{const o=e=>{h.value=e,t("select",A(e))};if(r&&"range"===e.type){if(!(a=>{const{maxRange:r,rangePrompt:o,showRangePrompt:l}=e;return!(r&&function(e){const t=e[0].getTime();return(e[1].getTime()-t)/864e5+1}(a)>r&&(l&&d(o||j("rangePrompt",r)),t("over-range"),1))})(a))return void(e.showConfirm?o([a[0],R(a[0],+e.maxRange-1)]):o(a))}o(a),r&&!e.showConfirm&&J()},Q=g((()=>O.value.reduce(((e,t)=>{var a,r;return e.push(...null!=(r=null==(a=t.disabledDays)?void 0:a.value)?r:[]),e}),[]))),X=a=>{if(e.readonly||!a.date)return;const{date:r}=a,{type:o}=e;if("range"===o){if(!h.value)return void K([r]);const[t,a]=h.value;if(t&&!a){const a=M(r,t);if(1===a){const e=((e,t,a)=>{var r;return null==(r=e.find((e=>-1===M(t,e.date)&&-1===M(e.date,a))))?void 0:r.date})(Q.value,t,r);e?K([t,H(e)]):K([t,r],!0)}else-1===a?K([r]):e.allowSameDay&&K([r,r],!0)}else K([r])}else if("multiple"===o){if(!h.value)return void K([r]);const a=h.value,o=a.findIndex((e=>0===M(e,r)));if(-1!==o){const[e]=a.splice(o,1);t("unselect",B(e))}else e.maxRange&&a.length>=e.maxRange?d(e.rangePrompt||j("rangePrompt",e.maxRange)):K([...a,r])}else K(r,!0)},Z=e=>t("update:show",e),$=(t,o)=>{const l=0!==o||!e.showSubtitle;return y(Y,D({ref:I(o),date:t,currentDate:h.value,showMonthTitle:l,firstDayOfWeek:N.value},a(e,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:X}),a(r,["top-info","bottom-info"]))},_=()=>{if(r.footer)return r.footer();if(e.showConfirm){const t=z.value?e.confirmDisabledText:e.confirmText;return y(f,{round:!0,block:!0,type:"danger",color:e.color,class:T("confirm"),disabled:z.value,nativeType:"button",onClick:J},{default:()=>[t||j("confirm")]})}},ee=()=>y("div",{class:T()},[y(q,{title:e.title,subtitle:p.value,showTitle:e.showTitle,showSubtitle:e.showSubtitle,firstDayOfWeek:N.value,"onClick-subtitle":e=>t("click-subtitle",e)},a(r,["title","subtitle"])),y("div",{ref:m,class:T("body"),onScroll:V},[F.value.map($)]),y("div",{class:[T("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[_()])]);return b((()=>e.show),U),b((()=>[e.type,e.minDate,e.maxDate]),(()=>G(l(h.value)))),b((()=>e.defaultDate),((e=null)=>{h.value=e,L()})),u({reset:G,scrollToDate:E}),S(U),()=>{if(e.poppable){let a;return y(c,D({show:e.show,class:T("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,closeOnClickOverlay:e.closeOnClickOverlay},{"onUpdate:show":Z}),"function"==typeof(t=a=ee())||"[object Object]"===Object.prototype.toString.call(t)&&!w(t)?a:{default:()=>[a]})}var t;return ee()}}}));export{V as C};
