import{o as R,m as _,l as H,e as F,c as K,i as M,n as Y}from"./use-translate.5cf29aa7.js";import{n as k,t as I,u as G,m as C,w as N}from"./with-install.28bb645f.js";import{L as x,I as U,x as S,z as V,C as j,B as $,M as J,J as Q,H as Z,e as f,T as q,R as W,F as X,j as ee,v as oe,Q as te}from"./vue-libs.cab43f37.js";import{H as ne}from"./constant.80c6de18.js";import{c as se}from"./interceptor.e15676cf.js";import{u as ae}from"./use-expose.e3e68c29.js";import{u as ce}from"./use-touch.0cf4a6e6.js";import{u as re}from"./use-lazy-render.c492e2a8.js";import{P as le}from"./on-popup-reopen.6de6ab9a.js";import{I as ie}from"./index.71a5f3d3.js";import{O as ue}from"./index.3de7b345.js";const L={show:Boolean,zIndex:k,overlay:I,duration:k,teleport:[String,Object],lockScroll:I,lazyRender:I,beforeClose:Function,overlayStyle:Object,overlayClass:G,transitionAppear:Boolean,closeOnClickOverlay:I},Se=Object.keys(L);let p=0;const g="van-overflow-hidden";function de(e,o){const s=ce(),a=r=>{s.move(r);const w=s.deltaY.value>0?"10":"01",h=_(r.target,e.value),{scrollHeight:l,offsetHeight:y,scrollTop:m}=h;let u="11";m===0?u=y>=l?"00":"01":m+y>=l&&(u="10"),u!=="11"&&s.isVertical()&&!(parseInt(u,2)&parseInt(w,2))&&H(r,!0)},n=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",a,{passive:!1}),p||document.body.classList.add(g),p++},c=()=>{p&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",a),p--,p||document.body.classList.remove(g))},v=()=>o()&&n(),i=()=>o()&&c();R(v),x(i),U(i),S(o,r=>{r?n():c()})}const fe=F({},L,{round:Boolean,position:C("center"),closeIcon:C("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:C("top-right"),safeAreaInsetBottom:Boolean}),[ve,z]=K("popup");let A=2e3;var me=V({name:ve,inheritAttrs:!1,props:fe,emits:["open","close","opened","closed","update:show","click-overlay","click-close-icon"],setup(e,{emit:o,attrs:s,slots:a}){let n,c;const v=j(),i=j(),r=re(()=>e.show||!e.lazyRender),w=$(()=>{const t={zIndex:v.value};if(M(e.duration)){const d=e.position==="center"?"animationDuration":"transitionDuration";t[d]=`${e.duration}s`}return t}),h=()=>{n||(e.zIndex!==void 0&&(A=+e.zIndex),n=!0,v.value=++A,o("open"))},l=()=>{n&&se(e.beforeClose,{done(){n=!1,o("close"),o("update:show",!1)}})},y=t=>{o("click-overlay",t),e.closeOnClickOverlay&&l()},m=()=>{if(e.overlay)return f(ue,{show:e.show,class:e.overlayClass,zIndex:v.value,duration:e.duration,customStyle:e.overlayStyle,onClick:y},{default:a["overlay-content"]})},u=t=>{o("click-close-icon",t),l()},B=()=>{if(e.closeable)return f(ie,{role:"button",tabindex:0,name:e.closeIcon,class:[z("close-icon",e.closeIconPosition),ne],classPrefix:e.iconPrefix,onClick:u},null)},E=()=>o("opened"),T=()=>o("closed"),D=r(()=>{var P;const{round:t,position:d,safeAreaInsetBottom:b}=e;return ee(f("div",te({ref:i,style:w.value,class:[z({round:t,[d]:d}),{"van-safe-area-bottom":b}]},s),[(P=a.default)==null?void 0:P.call(a),B()]),[[oe,e.show]])}),O=()=>{const{position:t,transition:d,transitionAppear:b}=e,P=t==="center"?"van-fade":`van-popup-slide-${t}`;return f(q,{name:d||P,appear:b,onAfterEnter:E,onAfterLeave:T},{default:D})};return S(()=>e.show,t=>{t?h():(n=!1,o("close"))}),ae({popupRef:i}),de(i,()=>e.show&&e.lockScroll),Y("popstate",()=>{e.closeOnPopstate&&(l(),c=!1)}),J(()=>{e.show&&h()}),Q(()=>{c&&(o("update:show",!0),c=!1)}),x(()=>{e.show&&(l(),c=!0)}),Z(le,()=>e.show),()=>e.teleport?f(W,{to:e.teleport},{default:()=>[m(),O()]}):f(X,null,[m(),O()])}});const je=N(me);export{je as P,Se as a,L as p};
