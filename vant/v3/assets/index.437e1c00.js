import{c as $,f as me,m as _,z as X,A as he,B as le,C as ge}from"./use-translate.789845f9.js";import{d as U,a as ye,n as Z,m as ie,t as B,b as ve,w as De}from"./with-install.c13b505f.js";import{u as be}from"./use-refs.2bafdad1.js";import{u as se}from"./use-expose.d54fed8a.js";import{P as we}from"./index.1210a5ca.js";import{B as ke}from"./index.2e0d9cdf.js";import{T as ce}from"./function-call.20857ce2.js";import{g as Se}from"./utils.2c1be9c4.js";import{u as Te}from"./use-height.91d5b778.js";import{D as H,z as q,C as x,e as c,x as p,A as xe,I as ue}from"./vue-libs.1dda7261.js";import{r as ee}from"./utils.39620306.js";import{o as Me}from"./index.904c4b4d.js";function Ce(e=!1){var l=H(e),i=(u=!l.value)=>{l.value=u};return[l,i]}const[Oe,d,I]=$("calendar"),Re=e=>I("monthTitle",e.getFullYear(),e.getMonth()+1);function te(e,l){const i=e.getFullYear(),u=l.getFullYear();if(i===u){const v=e.getMonth(),M=l.getMonth();return v===M?0:v>M?1:-1}return i>u?1:-1}function O(e,l){const i=te(e,l);if(i===0){const u=e.getDate(),v=l.getDate();return u===v?0:u>v?1:-1}return i}const L=e=>new Date(e),fe=e=>Array.isArray(e)?e.map(L):L(e);function ne(e,l){const i=L(e);return i.setDate(i.getDate()+l),i}const ae=e=>ne(e,-1),de=e=>ne(e,1),oe=()=>{const e=new Date;return e.setHours(0,0,0,0),e};function Pe(e){const l=e[0].getTime();return(e[1].getTime()-l)/(1e3*60*60*24)+1}const[Be]=$("calendar-day");var Ae=q({name:Be,props:{item:U(Object),color:String,index:Number,offset:ye(0),rowHeight:String},emits:["click"],setup(e,{emit:l,slots:i}){const u=x(()=>{const{item:a,index:h,color:S,offset:A,rowHeight:C}=e,w={height:C};if(a.type==="placeholder")return w.width="100%",w;if(h===0&&(w.marginLeft=`${100*A/7}%`),S)switch(a.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":w.background=S;break;case"middle":w.color=S;break}return w}),v=()=>{e.item.type!=="disabled"&&l("click",e.item)},M=()=>{const{topInfo:a}=e.item;if(a||i["top-info"])return c("div",{class:d("top-info")},[i["top-info"]?i["top-info"](e.item):a])},k=()=>{const{bottomInfo:a}=e.item;if(a||i["bottom-info"])return c("div",{class:d("bottom-info")},[i["bottom-info"]?i["bottom-info"](e.item):a])},D=()=>{const{item:a,color:h,rowHeight:S}=e,{type:A,text:C}=a,w=[M(),C,k()];return A==="selected"?c("div",{class:d("selected-day"),style:{width:S,height:S,background:h}},[w]):w};return()=>{const{type:a,className:h}=e.item;return a==="placeholder"?c("div",{class:d("day"),style:u.value},null):c("div",{role:"gridcell",style:u.value,class:[d("day",a),h],tabindex:a==="disabled"?void 0:-1,onClick:v},[D()])}}});const[je]=$("calendar-month"),Ie={date:U(Date),type:String,color:String,minDate:U(Date),maxDate:U(Date),showMark:Boolean,rowHeight:Z,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number};var He=q({name:je,props:Ie,emits:["click","update-height"],setup(e,{emit:l,slots:i}){const[u,v]=Ce(),M=H(),k=H(),D=Te(k),a=x(()=>Re(e.date)),h=x(()=>me(e.rowHeight)),S=x(()=>{const o=e.date.getDay();return e.firstDayOfWeek?(o+7-e.firstDayOfWeek)%7:o}),A=x(()=>Se(e.date.getFullYear(),e.date.getMonth()+1)),C=x(()=>u.value||!e.lazyRender),w=()=>a.value,N=o=>{const f=e.showSubtitle?M.value:k.value;if(f){const g=X(f).top-X(o).top+o.scrollTop;he(o,g)}},F=o=>{const f=g=>e.currentDate.some(m=>O(m,g)===0);if(f(o)){const g=ae(o),m=de(o),t=f(g),n=f(m);return t&&n?"multiple-middle":t?"end":n?"start":"multiple-selected"}return""},W=o=>{const[f,g]=e.currentDate;if(!f)return"";const m=O(o,f);if(!g)return m===0?"start":"";const t=O(o,g);return e.allowSameDay&&m===0&&t===0?"start-end":m===0?"start":t===0?"end":m>0&&t<0?"middle":""},V=o=>{const{type:f,minDate:g,maxDate:m,currentDate:t}=e;if(O(o,g)<0||O(o,m)>0)return"disabled";if(t===null)return"";if(Array.isArray(t)){if(f==="multiple")return F(o);if(f==="range")return W(o)}else if(f==="single")return O(o,t)===0?"selected":"";return""},z=o=>{if(e.type==="range"){if(o==="start"||o==="end")return I(o);if(o==="start-end")return I("startEnd")}},G=()=>{if(e.showMonthTitle)return c("div",{class:d("month-title")},[a.value])},Y=()=>{if(e.showMark&&C.value)return c("div",{class:d("month-mark")},[e.date.getMonth()+1])},R=x(()=>{const o=Math.ceil((A.value+S.value)/7);return Array(o).fill({type:"placeholder"})}),E=x(()=>{const o=[],f=e.date.getFullYear(),g=e.date.getMonth();for(let m=1;m<=A.value;m++){const t=new Date(f,g,m),n=V(t);let r={date:t,type:n,text:m,bottomInfo:z(n)};e.formatter&&(r=e.formatter(r)),o.push(r)}return o}),J=x(()=>E.value.filter(o=>o.type==="disabled")),K=(o,f)=>c(Ae,{item:o,index:f,color:e.color,offset:S.value,rowHeight:h.value,onClick:g=>l("click",g)},_(i,["top-info","bottom-info"])),Q=()=>c("div",{ref:M,role:"grid",class:d("days")},[Y(),(C.value?E:R).value.map(K)]);return se({getTitle:w,getHeight:()=>D.value,setVisible:v,scrollIntoView:N,disabledDays:J}),()=>c("div",{class:d("month"),ref:k},[G(),Q()])}});const[Ne]=$("calendar-header");var We=q({name:Ne,props:{title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["click-subtitle"],setup(e,{slots:l,emit:i}){const u=()=>{if(e.showTitle){const D=e.title||I("title"),a=l.title?l.title():D;return c("div",{class:d("header-title")},[a])}},v=D=>{i("click-subtitle",D)},M=()=>{if(e.showSubtitle){const D=l.subtitle?l.subtitle():e.subtitle;return c("div",{class:d("header-subtitle"),onClick:v},[D])}},k=()=>{const{firstDayOfWeek:D}=e,a=I("weekdays"),h=[...a.slice(D,7),...a.slice(0,D)];return c("div",{class:d("weekdays")},[h.map(S=>c("span",{class:d("weekday")},[S]))])};return()=>c("div",{class:d("header")},[u(),M(),k()])}});function Fe(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!xe(e)}const Ve={show:Boolean,type:ie("single"),title:String,color:String,round:B,readonly:Boolean,poppable:B,maxRange:ve(null),position:ie("bottom"),teleport:[String,Object],showMark:B,showTitle:B,formatter:Function,rowHeight:Z,confirmText:String,rangePrompt:String,lazyRender:B,showConfirm:B,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:B,closeOnPopstate:B,showRangePrompt:B,confirmDisabledText:String,closeOnClickOverlay:B,safeAreaInsetBottom:B,minDate:{type:Date,validator:le,default:oe},maxDate:{type:Date,validator:le,default:()=>{const e=oe();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:Z,default:0,validator:e=>e>=0&&e<=6}};var ze=q({name:Oe,props:Ve,emits:["select","confirm","unselect","month-show","over-range","update:show","click-subtitle"],setup(e,{emit:l,slots:i}){const u=(t,n=e.minDate,r=e.maxDate)=>O(t,n)===-1?n:O(t,r)===1?r:t,v=(t=e.defaultDate)=>{const{type:n,minDate:r,maxDate:s}=e;if(t===null)return t;const y=oe();if(n==="range"){Array.isArray(t)||(t=[]);const b=u(t[0]||y,r,ae(s)),j=u(t[1]||y,de(r));return[b,j]}return n==="multiple"?Array.isArray(t)?t.map(b=>u(b)):[u(y)]:((!t||Array.isArray(t))&&(t=y),u(t))};let M;const k=H(),D=H(""),a=H(v()),[h,S]=be(),A=x(()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0),C=x(()=>{const t=[],n=new Date(e.minDate);n.setDate(1);do t.push(new Date(n)),n.setMonth(n.getMonth()+1);while(te(n,e.maxDate)!==1);return t}),w=x(()=>{if(a.value){if(e.type==="range")return!a.value[0]||!a.value[1];if(e.type==="multiple")return!a.value.length}return!a.value}),N=()=>{const t=ge(k.value),n=t+M,r=C.value.map((T,P)=>h.value[P].getHeight()),s=r.reduce((T,P)=>T+P,0);if(n>s&&t>0)return;let y=0,b;const j=[-1,-1];for(let T=0;T<C.value.length;T++){const P=h.value[T];y<=n&&y+r[T]>=t&&(j[1]=T,b||(b=P,j[0]=T),h.value[T].showed||(h.value[T].showed=!0,l("month-show",{date:P.date,title:P.getTitle()}))),y+=r[T]}C.value.forEach((T,P)=>{const re=P>=j[0]-1&&P<=j[1]+1;h.value[P].setVisible(re)}),b&&(D.value=b.getTitle())},F=t=>{ee(()=>{C.value.some((n,r)=>te(n,t)===0?(k.value&&h.value[r].scrollIntoView(k.value),!0):!1),N()})},W=()=>{if(!(e.poppable&&!e.show))if(a.value){const t=e.type==="single"?a.value:a.value[0];F(t)}else ee(N)},V=()=>{e.poppable&&!e.show||ee(()=>{M=Math.floor(X(k).height),W()})},z=(t=v())=>{a.value=t,W()},G=t=>{const{maxRange:n,rangePrompt:r,showRangePrompt:s}=e;return n&&Pe(t)>n?(s&&ce(r||I("rangePrompt",n)),l("over-range"),!1):!0},Y=()=>{var t;return l("confirm",(t=a.value)!=null?t:fe(a.value))},R=(t,n)=>{const r=s=>{a.value=s,l("select",fe(s))};if(n&&e.type==="range"&&!G(t)){e.showConfirm?r([t[0],ne(t[0],+e.maxRange-1)]):r(t);return}r(t),n&&!e.showConfirm&&Y()},E=(t,n,r)=>{var s;return(s=t.find(y=>O(n,y.date)===-1&&O(y.date,r)===-1))==null?void 0:s.date},J=x(()=>h.value.reduce((t,n)=>{var r,s;return t.push(...(s=(r=n.disabledDays)==null?void 0:r.value)!=null?s:[]),t},[])),K=t=>{if(e.readonly||!t.date)return;const{date:n}=t,{type:r}=e;if(r==="range"){if(!a.value){R([n]);return}const[s,y]=a.value;if(s&&!y){const b=O(n,s);if(b===1){const j=E(J.value,s,n);j?R([s,ae(j)]):R([s,n],!0)}else b===-1?R([n]):e.allowSameDay&&R([n,n],!0)}else R([n])}else if(r==="multiple"){if(!a.value){R([n]);return}const s=a.value,y=s.findIndex(b=>O(b,n)===0);if(y!==-1){const[b]=s.splice(y,1);l("unselect",L(b))}else e.maxRange&&s.length>=e.maxRange?ce(e.rangePrompt||I("rangePrompt",e.maxRange)):R([...s,n])}else R(n,!0)},Q=t=>l("update:show",t),o=(t,n)=>{const r=n!==0||!e.showSubtitle;return c(He,ue({ref:S(n),date:t,currentDate:a.value,showMonthTitle:r,firstDayOfWeek:A.value},_(e,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:K}),_(i,["top-info","bottom-info"]))},f=()=>{if(i.footer)return i.footer();if(e.showConfirm){const t=w.value?e.confirmDisabledText:e.confirmText;return c(ke,{round:!0,block:!0,type:"danger",color:e.color,class:d("confirm"),disabled:w.value,nativeType:"button",onClick:Y},{default:()=>[t||I("confirm")]})}},g=()=>c("div",{class:[d("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[f()]),m=()=>c("div",{class:d()},[c(We,{title:e.title,subtitle:D.value,showTitle:e.showTitle,showSubtitle:e.showSubtitle,firstDayOfWeek:A.value,"onClick-subtitle":t=>l("click-subtitle",t)},_(i,["title","subtitle"])),c("div",{ref:k,class:d("body"),onScroll:N},[C.value.map(o)]),g()]);return p(()=>e.show,V),p(()=>[e.type,e.minDate,e.maxDate],()=>z(v(a.value))),p(()=>e.defaultDate,(t=null)=>{a.value=t,W()}),se({reset:z,scrollToDate:F}),Me(V),()=>{if(e.poppable){let t;return c(we,ue({show:e.show,class:d("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,closeOnClickOverlay:e.closeOnClickOverlay},{"onUpdate:show":Q}),Fe(t=m())?t:{default:()=>[t]})}return m()}}});const Ze=De(ze);export{Ze as C};
