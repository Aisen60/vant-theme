import{c as N,h as k,w as T,p as K,y as G,a as J,e as Q}from"./use-translate.33b17133.js";import{d as z,n as A,t as H,b as ee,c as R,u as oe,m as $,w as te}from"./with-install.d00852e2.js";import{m as ae,u as se}from"./mount-component.4efac25f.js";import{H as ne}from"./constant.80c6de18.js";import{c as ie}from"./interceptor.926f5054.js";import{u as ce}from"./use-expose.e553b263.js";import{I as le}from"./index.0a08d1ef.js";import{a as re,u as me,S as ue}from"./index.b2b5faa5.js";import{P as de}from"./index.9f327319.js";import{u as fe}from"./use-touch.ac1b49d9.js";import{I as ve}from"./index.4f816a4f.js";import{L as ge}from"./index.58fe8242.js";import{z as B,D as E,B as W,x as X,e as r,C as he,E as we,q as pe,L as xe,H as O}from"./vue-libs.7d3cdfcb.js";const L=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),_=N("image-preview")[1];var Pe=B({props:{src:String,show:Boolean,active:Number,minZoom:z(A),maxZoom:z(A),rootWidth:z(Number),rootHeight:z(Number)},emits:["scale","close"],setup(e,{emit:c}){const o=E({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=fe(),g=W(()=>{const{rootWidth:t,rootHeight:s}=e,n=s/t;return o.imageRatio>n}),i=W(()=>{const{scale:t,moveX:s,moveY:n,moving:u,zooming:I}=o,Y={transitionDuration:I||u?"0s":".3s"};if(t!==1){const V=s/t,U=n/t;Y.transform=`scale(${t}, ${t}) translate(${V}px, ${U}px)`}return Y}),m=W(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,n=g.value?s/o.imageRatio:t;return Math.max(0,(o.scale*n-t)/2)}return 0}),h=W(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,n=g.value?s:t*o.imageRatio;return Math.max(0,(o.scale*n-s)/2)}return 0}),w=t=>{t=T(t,+e.minZoom,+e.maxZoom),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},p=()=>{w(1),o.moveX=0,o.moveY=0},b=()=>{const t=o.scale>1?1:2;w(t),o.moveX=0,o.moveY=0};let x,P,y,j,d,C;const a=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),x=o.moveX,P=o.moveY,C=Date.now(),o.moving=s.length===1&&o.scale!==1,o.zooming=s.length===2&&!n.value,o.zooming&&(y=o.scale,j=L(t.touches))},f=t=>{const{touches:s}=t;if(l.move(t),(o.moving||o.zooming)&&k(t,!0),o.moving){const{deltaX:n,deltaY:u}=l,I=n.value+x,Y=u.value+P;o.moveX=T(I,-m.value,m.value),o.moveY=T(Y,-h.value,h.value)}if(o.zooming&&s.length===2){const n=L(s),u=y*n/j;w(u)}},v=()=>{const{offsetX:t,offsetY:s}=l,n=Date.now()-C,u=250,I=10;t.value<I&&s.value<I&&n<u&&(d?(clearTimeout(d),d=null,b()):d=setTimeout(()=>{c("close"),d=null},u))},M=t=>{let s=!1;(o.moving||o.zooming)&&(s=!0,o.moving&&x===o.moveX&&P===o.moveY&&(s=!1),t.touches.length||(o.zooming&&(o.moveX=T(o.moveX,-m.value,m.value),o.moveY=T(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,x=0,P=0,y=1,o.scale<1&&p())),k(t,s),v(),l.reset()},q=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;o.imageRatio=n/s};return X(()=>e.active,p),X(()=>e.show,t=>{t||p()}),()=>{const t={loading:()=>r(ge,{type:"spinner"},null)};return r(re,{class:_("swipe-item"),onTouchstart:a,onTouchmove:f,onTouchend:M,onTouchcancel:M},{default:()=>[r(ve,{src:e.src,fit:"contain",class:_("image",{vertical:g.value}),style:i.value,onLoad:q},t)]})}}});function Ie(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!xe(e)}const[Se,S]=N("image-preview"),be=["show","transition","overlayStyle","closeOnPopstate"],ye={show:Boolean,loop:H,images:ee(),minZoom:R(1/3),maxZoom:R(3),overlay:H,closeable:Boolean,showIndex:H,className:oe,closeIcon:$("clear"),transition:String,beforeClose:Function,overlayStyle:Object,swipeDuration:R(300),startPosition:R(0),showIndicators:Boolean,closeOnPopstate:H,closeIconPosition:$("top-right")};var F=B({name:Se,props:ye,emits:["scale","close","closed","change","update:show"],setup(e,{emit:c,slots:o}){const l=he(),g=me(),i=E({active:0,rootWidth:0,rootHeight:0}),m=()=>{if(l.value){const a=G(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},h=a=>c("scale",a),w=a=>c("update:show",a),p=()=>{ie(e.beforeClose,{args:[i.active],done:()=>w(!1)})},b=a=>{a!==i.active&&(i.active=a,c("change",a))},x=()=>{if(e.showIndex)return r("div",{class:S("index")},[o.index?o.index({index:i.active}):`${i.active+1} / ${e.images.length}`])},P=()=>{if(o.cover)return r("div",{class:S("cover")},[o.cover()])},y=()=>{let a;return r(ue,{ref:l,lazyRender:!0,loop:e.loop,class:S("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:b},Ie(a=e.images.map(f=>r(Pe,{src:f,show:e.show,active:i.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:h,onClose:p},null)))?a:{default:()=>[a]})},j=()=>{if(e.closeable)return r(le,{role:"button",name:e.closeIcon,class:[S("close-icon",e.closeIconPosition),ne],onClick:p},null)},d=()=>c("closed"),C=(a,f)=>{var v;return(v=l.value)==null?void 0:v.swipeTo(a,f)};return ce({swipeTo:C}),we(m),X([g.width,g.height],m),X(()=>e.startPosition,a=>b(+a)),X(()=>e.show,a=>{const{images:f,startPosition:v}=e;a?(b(+v),pe(()=>{m(),C(+v,{immediate:!0})})):c("close",{index:i.active,url:f[i.active]})}),()=>r(de,O({class:[S(),e.className],overlayClass:S("overlay"),onClosed:d,"onUpdate:show":w},K(e,be)),{default:()=>[j(),y(),x(),P()]})}});let Z;const Ce={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Te(){({instance:Z}=ae({setup(){const{state:e,toggle:c}=se(),o=()=>{e.images=[]};return()=>r(F,O(e,{onClosed:o,"onUpdate:show":c}),null)}}))}const D=(e,c=0)=>{if(!!J)return Z||Te(),e=Array.isArray(e)?{images:e,startPosition:c}:e,Z.open(Q({},Ce,e)),Z};D.Component=te(F);D.install=e=>{e.use(D.Component)};export{D as I};
