import{l as e,r as t,s as a,v as r,w as l,d as o,c as i,e as n,u as s,g as u,i as c,x as d,p as g,y as m}from"./use-translate.91889477.js";import{w as p}from"./with-install.c9eedd0e.js";import{F as f}from"./constant.4d85ecb9.js";import{c as v,C as h}from"./index.5d323f2c.js";import{u as b}from"./use-expose.5ea79906.js";import{I as y}from"./index.d38d9435.js";import{C as x}from"./index.a16d08bc.js";import{z as S,E as w,D as C,C as k,L as M,x as F,q as V,G as I,e as B,I as j,h as A}from"./vue-libs.71fdcafc.js";import{u as T}from"./useParent.e4fd6deb.js";function P(e,t){return(!t.required||!function(e){return Array.isArray(e)?!e.length:0!==e&&!e}(e))&&!(t.pattern&&!t.pattern.test(String(e)))}function z(e,a){const{message:r}=a;return t(r)?r(e,a):r||""}function L(e){e.target.composing=!0}function W(e){const{target:t}=e;t.composing&&(t.composing=!1,l(t,"input"))}const[q,E]=i("field"),N={id:String,name:String,formatter:Function,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:[Number,String],inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},clearIcon:{type:String,default:"clear"},modelValue:{type:[Number,String],default:""},clearTrigger:{type:String,default:"focus"},formatTrigger:{type:String,default:"onChange"}};const D=p(S({name:q,props:n({},v,N,{rows:[Number,String],rules:Array,autosize:[Boolean,Object],labelWidth:[Number,String],labelClass:s,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,type:{type:String,default:"text"},colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","click-input","click-left-icon","click-right-icon","update:modelValue"],setup(t,{emit:l,slots:i}){const n=w({focused:!1,validateFailed:!1,validateMessage:""}),s=C(),p=C(),{parent:v}=T(f),S=()=>{var e;return String(null!=(e=t.modelValue)?e:"")},q=e=>c(t[e])?t[e]:v&&c(v.props[e])?v.props[e]:void 0,N=k((()=>{const e=q("readonly");if(t.clearable&&!e){const e=""!==S(),a="always"===t.clearTrigger||"focus"===t.clearTrigger&&n.focused;return e&&a}return!1})),D=k((()=>p.value&&i.input?p.value():t.modelValue)),H=t=>t.reduce(((t,a)=>t.then((()=>{if(n.validateFailed)return;let{value:t}=D;return a.formatter&&(t=a.formatter(t,a)),P(t,a)?a.validator?function(t,a){return new Promise((r=>{const l=a.validator(t,a);if(e(l))return l.then(r);r(l)}))}(t,a).then((e=>{e&&"string"==typeof e?(n.validateFailed=!0,n.validateMessage=e):!1===e&&(n.validateFailed=!0,n.validateMessage=z(t,a))})):void 0:(n.validateFailed=!0,void(n.validateMessage=z(t,a)))}))),Promise.resolve()),O=()=>{n.validateFailed&&(n.validateFailed=!1,n.validateMessage="")},$=(e=t.rules)=>new Promise((a=>{O(),e?H(e).then((()=>{n.validateFailed?a({name:t.name,message:n.validateMessage}):a()})):a()})),G=e=>{if(v&&t.rules){const a=v.props.validateTrigger===e,r=t.rules.filter((t=>t.trigger?t.trigger===e:a));r.length&&$(r)}},K=(e,a="onChange")=>{if(e=(e=>{const{maxlength:a}=t;if(c(a)&&e.length>a){const t=S();return t&&t.length===+a?t:e.slice(0,+a)}return e})(e),"number"===t.type||"digit"===t.type){const a="number"===t.type;e=d(e,a,a)}t.formatter&&a===t.formatTrigger&&(e=t.formatter(e)),s.value&&s.value.value!==e&&(s.value.value=e),e!==t.modelValue&&l("update:modelValue",e)},J=e=>{e.target.composing||K(e.target.value)},Q=()=>{var e;return null==(e=s.value)?void 0:e.blur()},R=e=>{n.focused=!0,l("focus",e);q("readonly")&&Q()},U=e=>{n.focused=!1,K(S(),"onBlur"),l("blur",e),G("onBlur"),m()},X=e=>l("click-input",e),Y=e=>l("click-left-icon",e),Z=e=>l("click-right-icon",e),_=e=>{g(e),l("update:modelValue",""),l("clear",e)},ee=k((()=>"boolean"==typeof t.error?t.error:!!(v&&v.props.showError&&n.validateFailed)||void 0)),te=k((()=>{const e=q("labelWidth");if(e)return{width:u(e)}})),ae=e=>{if(13===e.keyCode){v&&v.props.submitOnEnter||"textarea"===t.type||g(e),"search"===t.type&&Q()}l("keypress",e)},re=()=>{const e=s.value;"textarea"===t.type&&t.autosize&&e&&function(e,t){const l=a();e.style.height="auto";let i=e.scrollHeight;if(o(t)){const{maxHeight:e,minHeight:a}=t;void 0!==e&&(i=Math.min(i,e)),void 0!==a&&(i=Math.max(i,a))}i&&(e.style.height=`${i}px`,r(l))}(e,t.autosize)},le=()=>{const e=E("control",[q("inputAlign"),{error:ee.value,custom:!!i.input,"min-height":"textarea"===t.type&&!t.autosize}]);if(i.input)return B("div",{class:e,onClick:X},[i.input()]);const a={id:t.id,ref:s,name:t.name,rows:void 0!==t.rows?+t.rows:void 0,class:e,value:t.modelValue,disabled:q("disabled"),readonly:q("readonly"),autofocus:t.autofocus,placeholder:t.placeholder,autocomplete:t.autocomplete,onBlur:U,onFocus:R,onInput:J,onClick:X,onChange:W,onKeypress:ae,onCompositionend:W,onCompositionstart:L};return"textarea"===t.type?B("textarea",a,null):B("input",j("number"===(r=t.type)?{type:"text",inputmode:"decimal"}:"digit"===r?{type:"tel",inputmode:"numeric"}:{type:r},a),null);var r},oe=()=>{const e=i["right-icon"];if(t.rightIcon||e)return B("div",{class:E("right-icon"),onClick:Z},[e?e():B(y,{name:t.rightIcon,classPrefix:t.iconPrefix},null)])},ie=()=>{if(t.showWordLimit&&t.maxlength){const e=S().length;return B("div",{class:E("word-limit")},[B("span",{class:E("word-num")},[e]),A("/"),t.maxlength])}},ne=()=>{if(v&&!1===v.props.showErrorMessage)return;const e=t.errorMessage||n.validateMessage;if(e){const t=q("errorMessageAlign");return B("div",{class:E("error-message",t)},[e])}},se=()=>[B("div",{class:E("body")},[le(),N.value&&B(y,{name:t.clearIcon,class:E("clear"),onTouchstart:_},null),oe(),i.button&&B("div",{class:E("button")},[i.button()])]),ie(),ne()];return b({blur:Q,focus:()=>{var e;return null==(e=s.value)?void 0:e.focus()},validate:$,formValue:D,resetValidation:O}),M(x,{customValue:p,resetValidation:O,validateWithTrigger:G}),F((()=>t.modelValue),(()=>{K(S()),O(),G("onChange"),V(re)})),I((()=>{K(S(),t.formatTrigger),V(re)})),()=>{const e=q("disabled"),a=q("labelAlign"),r=(()=>{const e=q("colon")?":":"";return i.label?[i.label(),e]:t.label?B("label",{for:t.id},[t.label+e]):void 0})(),l=(()=>{const e=i["left-icon"];if(t.leftIcon||e)return B("div",{class:E("left-icon"),onClick:Y},[e?e():B(y,{name:t.leftIcon,classPrefix:t.iconPrefix},null)])})();return B(h,{size:t.size,icon:t.leftIcon,class:E({error:ee.value,disabled:e,[`label-${a}`]:a}),center:t.center,border:t.border,isLink:t.isLink,clickable:t.clickable,titleStyle:te.value,valueClass:E("value"),titleClass:[E("label",[a,{required:t.required}]),t.labelClass],arrowDirection:t.arrowDirection},{icon:l?()=>l:null,title:r?()=>r:null,value:se,extra:i.extra})}}}));export{D as F,N as f};
