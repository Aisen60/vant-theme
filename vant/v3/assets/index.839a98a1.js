import{p as e,t,o as a}from"./use-translate.b583725c.js";import{c as r,a as o,b as l,w as n}from"./with-install.62f47d2f.js";import{u as s}from"./use-refs.7144ba67.js";import{u as i}from"./use-expose.33de0944.js";import{P as u}from"./index.aa2914ba.js";import{B as c}from"./index.627ee112.js";import{T as f}from"./function-call.b2678465.js";import{a as d}from"./unit.49c29796.js";import{g as m}from"./utils.06c87c13.js";import{u as p}from"./use-height.8171f077.js";import{E as v,A as h,D as g,e as y,y as b,B as w,J as D}from"./vendor.ef334a89.js";import{r as k}from"./utils.b0356070.js";import{o as S}from"./index.7e292110.js";import{u as x}from"./index.90a1ecc4.js";const[O,T,j]=r("calendar");function M(e,t){const a=e.getFullYear(),r=t.getFullYear();if(a===r){const a=e.getMonth(),r=t.getMonth();return a===r?0:a>r?1:-1}return a>r?1:-1}function B(e,t){const a=M(e,t);if(0===a){const a=e.getDate(),r=t.getDate();return a===r?0:a>r?1:-1}return a}const A=e=>new Date(e),C=e=>Array.isArray(e)?e.map(A):A(e);function R(e,t){const a=A(e);return a.setDate(a.getDate()+t),a}const H=e=>R(e,-1),P=e=>R(e,1),W=()=>{const e=new Date;return e.setHours(0,0,0,0),e};const[N]=r("calendar-day");var F=h({name:N,props:{color:String,index:Number,rowHeight:String,offset:{type:Number,default:0},item:{type:Object,required:!0}},emits:["click"],setup(e,{emit:t,slots:a}){const r=g((()=>{const{item:t,index:a,color:r,offset:o,rowHeight:l}=e,n={height:l};if("placeholder"===t.type)return n.width="100%",n;if(0===a&&(n.marginLeft=100*o/7+"%"),r)switch(t.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":n.background=r;break;case"middle":n.color=r}return n})),o=()=>{"disabled"!==e.item.type&&t("click",e.item)},l=()=>{const{topInfo:t}=e.item;if(t||a["top-info"])return y("div",{class:T("top-info")},[a["top-info"]?a["top-info"](e.item):t])},n=()=>{const{bottomInfo:t}=e.item;if(t||a["bottom-info"])return y("div",{class:T("bottom-info")},[a["bottom-info"]?a["bottom-info"](e.item):t])},s=()=>{const{item:t,color:a,rowHeight:r}=e,{type:o,text:s}=t,i=[l(),s,n()];return"selected"===o?y("div",{class:T("selected-day"),style:{width:r,height:r,background:a}},[i]):i};return()=>{const{type:t,className:a}=e.item;return"placeholder"===t?y("div",{class:T("day"),style:r.value},null):y("div",{role:"gridcell",style:r.value,class:[T("day",t),a],tabindex:"disabled"===t?void 0:-1,onClick:o},[s()])}}});const[I]=r("calendar-month");var Y=h({name:I,props:{type:String,color:String,showMark:Boolean,rowHeight:[Number,String],formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number,date:{type:Date,required:!0},minDate:{type:Date,required:!0},maxDate:{type:Date,required:!0}},emits:["click","update-height"],setup(t,{emit:a,slots:r}){const[l,n]=function(e=!1){var t=v(e);return[t,(e=!t.value)=>{t.value=e}]}(),s=v(),u=v(),c=p(u),f=g((()=>{return e=t.date,j("monthTitle",e.getFullYear(),e.getMonth()+1);var e})),h=g((()=>d(t.rowHeight))),b=g((()=>{const e=t.date.getDay();return t.firstDayOfWeek?(e+7-t.firstDayOfWeek)%7:e})),w=g((()=>m(t.date.getFullYear(),t.date.getMonth()+1))),D=g((()=>l.value||!t.lazyRender)),k=e=>{const{type:a,minDate:r,maxDate:o,currentDate:l}=t;if(B(e,r)<0||B(e,o)>0)return"disabled";if(null===l)return"";if(Array.isArray(l)){if("multiple"===a)return(e=>{const a=e=>t.currentDate.some((t=>0===B(t,e)));if(a(e)){const t=H(e),r=P(e),o=a(t),l=a(r);return o&&l?"multiple-middle":o?"end":l?"start":"multiple-selected"}return""})(e);if("range"===a)return(e=>{const[a,r]=t.currentDate;if(!a)return"";const o=B(e,a);if(!r)return 0===o?"start":"";const l=B(e,r);return t.allowSameDay&&0===o&&0===l?"start-end":0===o?"start":0===l?"end":o>0&&l<0?"middle":""})(e)}else if("single"===a)return 0===B(e,l)?"selected":"";return""},S=e=>{if("range"===t.type){if("start"===e||"end"===e)return j(e);if("start-end"===e)return j("startEnd")}},x=()=>{if(t.showMonthTitle)return y("div",{class:T("month-title")},[f.value])},O=()=>{if(t.showMark&&D.value)return y("div",{class:T("month-mark")},[t.date.getMonth()+1])},M=g((()=>{const e=Math.ceil((w.value+b.value)/7);return Array(e).fill({type:"placeholder"})})),A=g((()=>{const e=[],a=t.date.getFullYear(),r=t.date.getMonth();for(let o=1;o<=w.value;o++){const l=new Date(a,r,o),n=k(l);let s={date:l,type:n,text:o,bottomInfo:S(n)};t.formatter&&(s=t.formatter(s)),e.push(s)}return e})),C=g((()=>A.value.filter((e=>"disabled"===e.type)))),R=(o,l)=>y(F,{item:o,index:l,color:t.color,offset:b.value,rowHeight:h.value,onClick:e=>a("click",e)},e(r,["top-info","bottom-info"]));return i({getTitle:()=>f.value,getHeight:()=>c.value,setVisible:n,scrollIntoView:e=>{const a=t.showSubtitle?s.value:u.value;if(a){const t=a.getBoundingClientRect().top-e.getBoundingClientRect().top+e.scrollTop;o(e,t)}},disabledDays:C}),()=>y("div",{class:T("month"),ref:u},[x(),y("div",{ref:s,role:"grid",class:T("days")},[O(),(D.value?A:M).value.map(R)])])}});const[q]=r("calendar-header");var z=h({name:q,props:{title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["click-subtitle"],setup(e,{slots:t,emit:a}){const r=()=>{if(e.showTitle){const a=e.title||j("title"),r=t.title?t.title():a;return y("div",{class:T("header-title")},[r])}},o=e=>{a("click-subtitle",e)},l=()=>{if(e.showSubtitle){const a=t.subtitle?t.subtitle():e.subtitle;return y("div",{class:T("header-subtitle"),onClick:o},[a])}},n=()=>{const{firstDayOfWeek:t}=e,a=j("weekdays"),r=[...a.slice(t,7),...a.slice(0,t)];return y("div",{class:T("weekdays")},[r.map((e=>y("span",{class:T("weekday")},[e])))])};return()=>y("div",{class:T("header")},[r(),l(),n()])}});const V=n(h({name:O,props:{show:Boolean,title:String,color:String,round:t,readonly:Boolean,poppable:t,teleport:[String,Object],showMark:t,showTitle:t,formatter:Function,rowHeight:[Number,String],confirmText:String,rangePrompt:String,lazyRender:t,showConfirm:t,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:t,closeOnPopstate:t,confirmDisabledText:String,closeOnClickOverlay:t,safeAreaInsetBottom:t,type:{type:String,default:"single"},position:{type:String,default:"bottom"},maxRange:{type:[Number,String],default:null},minDate:{type:Date,validator:a,default:W},maxDate:{type:Date,validator:a,default:()=>{const e=W();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:[Number,String],default:0,validator:e=>e>=0&&e<=6},showRangePrompt:{type:Boolean,default:!0}},emits:["select","confirm","unselect","month-show","over-range","update:show","click-subtitle"],setup(t,{emit:a,slots:r}){const o=(e,a=t.minDate,r=t.maxDate)=>-1===B(e,a)?a:1===B(e,r)?r:e,n=(e=t.defaultDate)=>{const{type:a,minDate:r,maxDate:l}=t;if(null===e)return e;const n=W();if("range"===a){Array.isArray(e)||(e=[]);return[o(e[0]||n,r,H(l)),o(e[1]||n,P(r))]}return"multiple"===a?Array.isArray(e)?e.map((e=>o(e))):[o(n)]:(e&&!Array.isArray(e)||(e=n),o(e))};let d;const m=v(),p=v(""),h=v(n()),[O,N]=s(),F=g((()=>t.firstDayOfWeek?+t.firstDayOfWeek%7:0)),I=g((()=>{const e=[],a=new Date(t.minDate);a.setDate(1);do{e.push(new Date(a)),a.setMonth(a.getMonth()+1)}while(1!==M(a,t.maxDate));return e})),q=g((()=>{if(h.value){if("range"===t.type)return!h.value[0]||!h.value[1];if("multiple"===t.type)return!h.value.length}return!h.value})),V=()=>{const e=l(m.value),t=e+d,r=I.value.map(((e,t)=>O.value[t].getHeight()));if(t>r.reduce(((e,t)=>e+t),0)&&e>0)return;let o,n=0;const s=[-1,-1];for(let l=0;l<I.value.length;l++){const i=O.value[l];n<=t&&n+r[l]>=e&&(s[1]=l,o||(o=i,s[0]=l),O.value[l].showed||(O.value[l].showed=!0,a("month-show",{date:i.date,title:i.getTitle()}))),n+=r[l]}I.value.forEach(((e,t)=>{const a=t>=s[0]-1&&t<=s[1]+1;O.value[t].setVisible(a)})),o&&(p.value=o.getTitle())},E=e=>{k((()=>{I.value.some(((t,a)=>0===M(t,e)&&(m.value&&O.value[a].scrollIntoView(m.value),!0))),V()}))},J=()=>{if(!t.poppable||t.show)if(h.value){const e="single"===t.type?h.value:h.value[0];E(e)}else k(V)},L=()=>{t.poppable&&!t.show||k((()=>{d=Math.floor(x(m).height),J()}))},U=(e=n())=>{h.value=e,J()},G=()=>{var e;return a("confirm",null!=(e=h.value)?e:C(h.value))},K=(e,r)=>{const o=e=>{h.value=e,a("select",C(e))};if(r&&"range"===t.type){if(!(e=>{const{maxRange:r,rangePrompt:o,showRangePrompt:l}=t;return!(r&&function(e){const t=e[0].getTime();return(e[1].getTime()-t)/864e5+1}(e)>r&&(l&&f(o||j("rangePrompt",r)),a("over-range"),1))})(e))return void(t.showConfirm?o([e[0],R(e[0],+t.maxRange-1)]):o(e))}o(e),r&&!t.showConfirm&&G()},Q=g((()=>O.value.reduce(((e,t)=>{var a,r;return e.push(...null!=(r=null==(a=t.disabledDays)?void 0:a.value)?r:[]),e}),[]))),X=e=>{if(t.readonly||!e.date)return;const{date:r}=e,{type:o}=t;if("range"===o){if(!h.value)return void K([r]);const[e,a]=h.value;if(e&&!a){const a=B(r,e);if(1===a){const t=((e,t,a)=>{var r;return null==(r=e.find((e=>-1===B(t,e.date)&&-1===B(e.date,a))))?void 0:r.date})(Q.value,e,r);if(t){const a=H(t);K([e,a])}else K([e,r],!0)}else-1===a?K([r]):t.allowSameDay&&K([r,r],!0)}else K([r])}else if("multiple"===o){if(!h.value)return void K([r]);const e=h.value,o=e.findIndex((e=>0===B(e,r)));if(-1!==o){const[t]=e.splice(o,1);a("unselect",A(t))}else t.maxRange&&e.length>=t.maxRange?f(t.rangePrompt||j("rangePrompt",t.maxRange)):K([...e,r])}else K(r,!0)},Z=e=>a("update:show",e),$=(a,o)=>{const l=0!==o||!t.showSubtitle;return y(Y,D({ref:N(o),date:a,currentDate:h.value,showMonthTitle:l,firstDayOfWeek:F.value},e(t,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:X}),e(r,["top-info","bottom-info"]))},_=()=>{if(r.footer)return r.footer();if(t.showConfirm){const e=q.value?t.confirmDisabledText:t.confirmText;return y(c,{round:!0,block:!0,type:"danger",color:t.color,class:T("confirm"),disabled:q.value,nativeType:"button",onClick:G},{default:()=>[e||j("confirm")]})}},ee=()=>y("div",{class:T()},[y(z,{title:t.title,subtitle:p.value,showTitle:t.showTitle,showSubtitle:t.showSubtitle,firstDayOfWeek:F.value,"onClick-subtitle":e=>{a("click-subtitle",e)}},e(r,["title","subtitle"])),y("div",{ref:m,class:T("body"),onScroll:V},[I.value.map($)]),y("div",{class:[T("footer"),{"van-safe-area-bottom":t.safeAreaInsetBottom}]},[_()])]);return b((()=>t.show),L),b((()=>[t.type,t.minDate,t.maxDate]),(()=>{U(n(h.value))})),b((()=>t.defaultDate),((e=null)=>{h.value=e,J()})),i({reset:U,scrollToDate:E}),S(L),()=>{if(t.poppable){let a;return y(u,D({show:t.show,class:T("popup"),round:t.round,position:t.position,closeable:t.showTitle||t.showSubtitle,teleport:t.teleport,closeOnPopstate:t.closeOnPopstate,closeOnClickOverlay:t.closeOnClickOverlay},{"onUpdate:show":Z}),"function"==typeof(e=a=ee())||"[object Object]"===Object.prototype.toString.call(e)&&!w(e)?a:{default:()=>[a]})}var e;return ee()}}}));export{V as C};
