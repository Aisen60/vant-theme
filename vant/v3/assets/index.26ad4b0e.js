import{o as _,l as H,m as F,e as K,c as M,i as Y,n as G}from"./use-translate.43484c14.js";import{n as O,t as I,u as N,m as b,w as U}from"./with-install.d47ea1a2.js";import{L as x,I as V,x as S,z as $,C as j,B as J,M as Q,J as Z,H as q,e as f,T as W,R as X,F as ee,j as oe,v as te,Q as ne}from"./vue-libs.f710b8ed.js";import{H as se}from"./constant.80c6de18.js";import{c as ae}from"./interceptor.bbea64df.js";import{u as ce}from"./use-expose.f4ec549a.js";import{u as re}from"./use-touch.8e5a0907.js";import{u as le}from"./use-lazy-render.c4d421a8.js";import{P as ie}from"./on-popup-reopen.4b166a39.js";import{I as ue}from"./index.2cac46c1.js";import{O as de}from"./index.bd0fe4b9.js";const L={show:Boolean,zIndex:O,overlay:I,duration:O,teleport:[String,Object],lockScroll:I,lazyRender:I,beforeClose:Function,overlayStyle:Object,overlayClass:N,transitionAppear:Boolean,closeOnClickOverlay:I},je=Object.keys(L);let p=0;const g="van-overflow-hidden";function fe(e,t){const s=re(),a=r=>{s.move(r);const k=s.deltaY.value>0?"10":"01",h=H(r.target,e.value),{scrollHeight:l,offsetHeight:y,scrollTop:m}=h;let u="11";m===0?u=y>=l?"00":"01":m+y>=l&&(u="10"),u!=="11"&&s.isVertical()&&!(parseInt(u,2)&parseInt(k,2))&&F(r,!0)},n=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",a,{passive:!1}),p||document.body.classList.add(g),p++},c=()=>{p&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",a),p--,p||document.body.classList.remove(g))},v=()=>t()&&n(),i=()=>t()&&c();_(v),x(i),V(i),S(t,r=>{r?n():c()})}const ve=K({},L,{round:Boolean,position:b("center"),closeIcon:b("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:b("top-right"),safeAreaInsetBottom:Boolean}),[me,z]=M("popup");let A=2e3;var pe=$({name:me,inheritAttrs:!1,props:ve,emits:["open","close","click","opened","closed","update:show","click-overlay","click-close-icon"],setup(e,{emit:t,attrs:s,slots:a}){let n,c;const v=j(),i=j(),r=le(()=>e.show||!e.lazyRender),k=J(()=>{const o={zIndex:v.value};if(Y(e.duration)){const d=e.position==="center"?"animationDuration":"transitionDuration";o[d]=`${e.duration}s`}return o}),h=()=>{n||(e.zIndex!==void 0&&(A=+e.zIndex),n=!0,v.value=++A,t("open"))},l=()=>{n&&ae(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},y=o=>{t("click-overlay",o),e.closeOnClickOverlay&&l()},m=()=>{if(e.overlay)return f(de,{show:e.show,class:e.overlayClass,zIndex:v.value,duration:e.duration,customStyle:e.overlayStyle,onClick:y},{default:a["overlay-content"]})},u=o=>{t("click-close-icon",o),l()},B=()=>{if(e.closeable)return f(ue,{role:"button",tabindex:0,name:e.closeIcon,class:[z("close-icon",e.closeIconPosition),se],classPrefix:e.iconPrefix,onClick:u},null)},E=o=>t("click",o),T=()=>t("opened"),D=()=>t("closed"),R=r(()=>{var P;const{round:o,position:d,safeAreaInsetBottom:C}=e;return oe(f("div",ne({ref:i,style:k.value,class:[z({round:o,[d]:d}),{"van-safe-area-bottom":C}],onClick:E},s),[(P=a.default)==null?void 0:P.call(a),B()]),[[te,e.show]])}),w=()=>{const{position:o,transition:d,transitionAppear:C}=e,P=o==="center"?"van-fade":`van-popup-slide-${o}`;return f(W,{name:d||P,appear:C,onAfterEnter:T,onAfterLeave:D},{default:R})};return S(()=>e.show,o=>{o?h():(n=!1,t("close"))}),ce({popupRef:i}),fe(i,()=>e.show&&e.lockScroll),G("popstate",()=>{e.closeOnPopstate&&(l(),c=!1)}),Q(()=>{e.show&&h()}),Z(()=>{c&&(t("update:show",!0),c=!1)}),x(()=>{e.show&&(l(),c=!0)}),q(ie,()=>e.show),()=>e.teleport?f(X,{to:e.teleport},{default:()=>[m(),w()]}):f(ee,null,[m(),w()])}});const Le=U(pe);export{Le as P,je as a,L as p};
