import{c as e,d as a,e as t,t as s,q as l,a as o}from"./use-translate.91889477.js";import{w as r}from"./with-install.c9eedd0e.js";import{z as d,D as n,e as i,I as u,F as c,E as m,C as p,x as h,k as f,v as g,q as b,r as v,o as w,c as C,w as j,B as x}from"./vue-libs.71fdcafc.js";import{u as y}from"./use-expose.5ea79906.js";import{A as D,a as S}from"./index.602aa9cc.js";import{C as A}from"./index.5d323f2c.js";import{F as R}from"./index.69c5a5bd.js";import{P as B}from"./index.b58615a3.js";import{T as P}from"./function-call.470433b8.js";import{B as k}from"./index.60661b5f.js";import{D as F}from"./function-call.1456f37b.js";import{S as M}from"./index.954014f6.js";import"./deep-clone.8c2eaed3.js";import"./Picker.63c6d9b8.js";import"./constant.4d85ecb9.js";import"./index.6e9dbec3.js";import"./use-touch.30351383.js";import"./useParent.e4fd6deb.js";import"./useChildren.edf9a3d1.js";import"./index.9ab48093.js";import"./use-route.913efdd2.js";import"./index.d38d9435.js";import"./index.a16d08bc.js";import"./interceptor.fd551ac3.js";import"./index.94f7437a.js";import"./utils.b0356070.js";import"./index.9e2e36ca.js";import"./use-lazy-render.3dcfda58.js";import"./on-popup-reopen.d7054786.js";import"./index.38991bce.js";import"./mount-component.d3f8f39a.js";import"./index.f84002e0.js";const[V,I,N]=e("address-edit-detail");var U=d({name:V,props:{show:Boolean,value:String,focused:Boolean,detailRows:[Number,String],searchResult:Array,errorMessage:String,detailMaxlength:[Number,String],showSearchResult:Boolean},emits:["blur","focus","input","select-search"],setup(e,{emit:a}){const t=n(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,l=()=>{if(!s())return;const{searchResult:t}=e;return t.map((t=>i(A,{clickable:!0,key:t.name+t.address,icon:"location-o",label:t.address,class:I("search-item"),border:!1,onClick:()=>(e=>{a("select-search",e),a("input",`${e.address||""} ${e.name||""}`.trim())})(t)},{title:()=>(a=>{if(a.name){const t=a.name.replace(e.value,`<span class=${I("keyword")}>${e.value}</span>`);return i("div",{innerHTML:t},null)}})(t)})))},o=e=>a("blur",e),r=e=>a("focus",e),d=e=>a("input",e);return()=>{if(e.show)return i(c,null,[i(R,u({autosize:!0,clearable:!0,ref:t,class:I(),rows:e.detailRows,type:"textarea",label:N("label"),border:!s(),maxlength:e.detailMaxlength,modelValue:e.value,placeholder:N("placeholder"),errorMessage:e.errorMessage,onBlur:o,onFocus:r},{"onUpdate:modelValue":d}),null),l()])}}});const[L,T,z]=e("address-edit"),E={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,postalCode:"",addressDetail:""};const $=r(d({name:L,props:{areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:s,showDetail:s,showDelete:Boolean,showPostal:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:[Number,String],showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:{type:[Number,String],default:1},detailMaxlength:{type:[Number,String],default:200},addressInfo:{type:Object,default:()=>t({},E)},telValidator:{type:Function,default:l},postalValidator:{type:Function,default:e=>/^\d{6}$/.test(e)},areaColumnsPlaceholder:{type:Array,default:()=>[]}},emits:["save","focus","delete","click-area","change-area","change-detail","cancel-delete","select-search","change-default"],setup(e,{emit:s,slots:l}){const o=n(),r=m({data:{},showAreaPopup:!1,detailFocused:!1,errorInfo:{tel:"",name:"",areaCode:"",postalCode:"",addressDetail:""}}),d=p((()=>a(e.areaList)&&Object.keys(e.areaList).length)),u=p((()=>{const{country:e,province:a,city:t,county:s,areaCode:l}=r.data;if(l){const l=[e,a,t,s];return a&&a===t&&l.splice(1,1),l.filter(Boolean).join("/")}return""})),c=p((()=>{var a;return(null==(a=e.searchResult)?void 0:a.length)&&r.detailFocused})),v=()=>{if(o.value){const e=o.value.getArea();e.areaCode=e.code,delete e.code,t(r.data,e)}},w=e=>{r.errorInfo[e]="",r.detailFocused="addressDetail"===e,s("focus",e)},C=()=>{const a=["name","tel"];e.showArea&&a.push("areaCode"),e.showDetail&&a.push("addressDetail"),e.showPostal&&a.push("postalCode");a.every((a=>{const t=(a=>{const t=String(r.data[a]||"").trim();if(e.validator){const s=e.validator(a,t);if(s)return s}switch(a){case"name":return t?"":z("nameEmpty");case"tel":return e.telValidator(t)?"":z("telInvalid");case"areaCode":return t?"":z("areaEmpty");case"addressDetail":return t?"":z("addressEmpty");case"postalCode":return t&&!e.postalValidator(t)?z("postalEmpty"):""}})(a);return t&&(r.errorInfo[a]=t),!t}))&&!e.isSaving&&s("save",r.data)},j=e=>{r.data.addressDetail=e,s("change-detail",e)},x=e=>{(e=e.filter(Boolean)).some((e=>!e.code))?P(z("areaEmpty")):(r.showAreaPopup=!1,v(),s("change-area",e))},S=()=>{F.confirm({title:z("confirmDelete")}).then((()=>s("delete",r.data))).catch((()=>s("cancel-delete",r.data)))},V=e=>{r.data.areaCode=e||"",e&&b(v)},I=()=>{setTimeout((()=>{r.detailFocused=!1}))},N=()=>{if(e.showSetDefault){const e={"right-icon":()=>i(M,{modelValue:r.data.isDefault,"onUpdate:modelValue":e=>r.data.isDefault=e,size:"24",onChange:e=>s("change-default",e)},null)};return f(i(A,{center:!0,title:z("defaultAddress"),class:T("default")},e),[[g,!c.value]])}return null};return y({getArea:()=>o.value?o.value.getValues():[],setAreaCode:V,setAddressDetail:e=>{r.data.addressDetail=e}}),h((()=>e.areaList),(()=>V(r.data.areaCode))),h((()=>e.addressInfo),(e=>{r.data=t({},E,e),V(e.areaCode)}),{deep:!0,immediate:!0}),()=>{var a;const{data:t,errorInfo:n}=r,{disableArea:m}=e;return i("div",{class:T()},[i("div",{class:T("fields")},[i(R,{modelValue:t.name,"onUpdate:modelValue":e=>t.name=e,clearable:!0,label:z("name"),placeholder:z("name"),errorMessage:n.name,onFocus:()=>w("name")},null),i(R,{modelValue:t.tel,"onUpdate:modelValue":e=>t.tel=e,clearable:!0,type:"tel",label:z("tel"),maxlength:e.telMaxlength,placeholder:z("tel"),errorMessage:n.tel,onFocus:()=>w("tel")},null),f(i(R,{readonly:!0,label:z("area"),"is-link":!m,modelValue:u.value,placeholder:e.areaPlaceholder||z("area"),errorMessage:n.areaCode,onFocus:()=>w("areaCode"),onClick:()=>{s("click-area"),r.showAreaPopup=!m}},null),[[g,e.showArea]]),i(U,{show:e.showDetail,value:t.addressDetail,focused:r.detailFocused,detailRows:e.detailRows,errorMessage:n.addressDetail,searchResult:e.searchResult,detailMaxlength:e.detailMaxlength,showSearchResult:e.showSearchResult,onBlur:I,onFocus:()=>w("addressDetail"),onInput:j,"onSelect-search":e=>s("select-search",e)},null),e.showPostal&&f(i(R,{modelValue:t.postalCode,"onUpdate:modelValue":e=>t.postalCode=e,type:"tel",label:z("postal"),maxlength:"6",placeholder:z("postal"),errorMessage:n.postalCode,onFocus:()=>w("postalCode")},null),[[g,!c.value]]),null==(a=l.default)?void 0:a.call(l)]),N(),f(i("div",{class:T("buttons")},[i(k,{block:!0,round:!0,type:"danger",text:e.saveButtonText||z("save"),class:T("button"),loading:e.isSaving,onClick:C},null),e.showDelete&&i(k,{block:!0,round:!0,class:T("button"),loading:e.isDeleting,text:e.deleteButtonText||z("delete"),onClick:S},null)]),[[g,!c.value]]),i(B,{show:r.showAreaPopup,"onUpdate:show":e=>r.showAreaPopup=e,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[i(D,{ref:o,value:t.areaCode,loading:!d.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:x,onCancel:()=>{r.showAreaPopup=!1}},null)]})])}}}));const O=d({setup(e){const a=o({"zh-CN":{areaColumnsPlaceholder:["请选择","请选择","请选择"],searchResult:[{name:"黄龙万科中心",address:"杭州市西湖区"},{name:"黄龙万科中心G座"},{name:"黄龙万科中心H座",address:"杭州市西湖区"}]},"en-US":{areaColumnsPlaceholder:["Choose","Choose","Choose"],searchResult:[{name:"Name1",address:"Address"},{name:"Name2"},{name:"Name3",address:"Address"}]}}),t=n([]),s=()=>P(a("save")),l=()=>P(a("delete")),r=e=>{t.value=e?a("searchResult"):[]};return(e,o)=>{const d=v("demo-block");return w(),C(d,{title:x(a)("basicUsage")},{default:j((()=>[i(x($),{"area-list":x(S),"show-postal":"","show-delete":"","show-set-default":"","show-search-result":"","search-result":t.value,"area-columns-placeholder":x(a)("areaColumnsPlaceholder"),onSave:s,onDelete:l,onChangeDetail:r},null,8,["area-list","search-result","area-columns-placeholder"])])),_:1},8,["title"])}}});export{O as default};
