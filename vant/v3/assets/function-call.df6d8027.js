import{p as o,t as e,u as t,b as a,e as s}from"./use-translate.b583725c.js";import{c as i,w as n}from"./with-install.62f47d2f.js";import{m as r,u as l}from"./mount-component.4a14b4e1.js";import{c}from"./interceptor.ab1192d4.js";import{u as m}from"./use-expose.33de0944.js";import{I as u}from"./index.3af24151.js";import{a as v,u as d,S as p}from"./index.c15090cc.js";import{P as g}from"./index.aa2914ba.js";import{p as h}from"./event.7d40caae.js";import{c as f}from"./number.b01aa591.js";import{u as w}from"./use-touch.ce80657e.js";import{I as y}from"./index.620c085b.js";import{L as b}from"./index.6fa13143.js";import{A as x,G as j,D as S,y as I,e as C,E as X,H as P,s as Y,B as N,J as Z}from"./vendor.ef334a89.js";function z(o){return Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2)}const H=i("image-preview")[1];var W=x({props:{src:String,show:Boolean,active:Number,minZoom:{type:[Number,String],required:!0},maxZoom:{type:[Number,String],required:!0},rootWidth:{type:Number,required:!0},rootHeight:{type:Number,required:!0}},emits:["scale","close"],setup(o,{emit:e}){const t=j({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),a=w(),s=S((()=>{const{rootWidth:e,rootHeight:a}=o,s=a/e;return t.imageRatio>s})),i=S((()=>{const{scale:o,moveX:e,moveY:a,moving:s,zooming:i}=t,n={transitionDuration:i||s?"0s":".3s"};if(1!==o){const t=e/o,s=a/o;n.transform=`scale(${o}, ${o}) translate(${t}px, ${s}px)`}return n})),n=S((()=>{if(t.imageRatio){const{rootWidth:e,rootHeight:a}=o,i=s.value?a/t.imageRatio:e;return Math.max(0,(t.scale*i-e)/2)}return 0})),r=S((()=>{if(t.imageRatio){const{rootWidth:e,rootHeight:a}=o,i=s.value?a:e*t.imageRatio;return Math.max(0,(t.scale*i-a)/2)}return 0})),l=a=>{(a=f(a,+o.minZoom,+o.maxZoom))!==t.scale&&(t.scale=a,e("scale",{scale:a,index:o.active}))},c=()=>{l(1),t.moveX=0,t.moveY=0};let m,u,d,p,g,x;const X=o=>{const{touches:e}=o,{offsetX:s}=a;a.start(o),m=t.moveX,u=t.moveY,x=Date.now(),t.moving=1===e.length&&1!==t.scale,t.zooming=2===e.length&&!s.value,t.zooming&&(d=t.scale,p=z(o.touches))},P=o=>{const{touches:e}=o;if(a.move(o),(t.moving||t.zooming)&&h(o,!0),t.moving){const{deltaX:o,deltaY:e}=a,s=o.value+m,i=e.value+u;t.moveX=f(s,-n.value,n.value),t.moveY=f(i,-r.value,r.value)}if(t.zooming&&2===e.length){const o=z(e);l(d*o/p)}},Y=()=>{const{offsetX:o,offsetY:s}=a,i=Date.now()-x;o.value<10&&s.value<10&&i<250&&(g?(clearTimeout(g),g=null,(()=>{const o=t.scale>1?1:2;l(o),t.moveX=0,t.moveY=0})()):g=setTimeout((()=>{e("close"),g=null}),250))},N=o=>{let e=!1;(t.moving||t.zooming)&&(e=!0,t.moving&&m===t.moveX&&u===t.moveY&&(e=!1),o.touches.length||(t.zooming&&(t.moveX=f(t.moveX,-n.value,n.value),t.moveY=f(t.moveY,-r.value,r.value),t.zooming=!1),t.moving=!1,m=0,u=0,d=1,t.scale<1&&c())),h(o,e),Y(),a.reset()},Z=o=>{const{naturalWidth:e,naturalHeight:a}=o.target;t.imageRatio=a/e};return I((()=>o.active),c),I((()=>o.show),(o=>{o||c()})),()=>{const e={loading:()=>C(b,{type:"spinner"},null)};return C(v,{class:H("swipe-item"),onTouchstart:X,onTouchmove:P,onTouchend:N,onTouchcancel:N},{default:()=>[C(y,{src:o.src,fit:"contain",class:H("image",{vertical:s.value}),style:i.value,onLoad:Z},e)]})}}});const[R,T]=i("image-preview");var D=x({name:R,props:{show:Boolean,loop:e,overlay:e,closeable:Boolean,showIndex:e,className:t,transition:String,beforeClose:Function,overlayStyle:Object,showIndicators:Boolean,closeOnPopstate:e,images:{type:Array,default:()=>[]},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},closeIcon:{type:String,default:"clear"},closeIconPosition:{type:String,default:"top-right"}},emits:["scale","close","closed","change","update:show"],setup(e,{emit:t,slots:a}){const s=X(),i=d(),n=j({active:0,rootWidth:0,rootHeight:0}),r=()=>{if(s.value){const o=s.value.$el.getBoundingClientRect();n.rootWidth=o.width,n.rootHeight=o.height,s.value.resize()}},l=o=>t("scale",o),v=o=>t("update:show",o),h=()=>{c({interceptor:e.beforeClose,args:[n.active],done:()=>v(!1)})},f=o=>{o!==n.active&&(n.active=o,t("change",o))},w=()=>{if(e.showIndex)return C("div",{class:T("index")},[a.index?a.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},y=()=>{if(a.cover)return C("div",{class:T("cover")},[a.cover()])},b=()=>{let o;return C(p,{ref:s,lazyRender:!0,loop:e.loop,class:T("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:f},"function"==typeof(t=o=e.images.map((o=>C(W,{src:o,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,onScale:l,onClose:h},null))))||"[object Object]"===Object.prototype.toString.call(t)&&!N(t)?o:{default:()=>[o]});var t},x=()=>{if(e.closeable)return C(u,{role:"button",name:e.closeIcon,class:T("close-icon",e.closeIconPosition),onClick:h},null)},S=()=>t("closed"),z=(o,e)=>{var t;return null==(t=s.value)?void 0:t.swipeTo(o,e)};return m({swipeTo:z}),P(r),I([i.width,i.height],r),I((()=>e.startPosition),(o=>f(+o))),I((()=>e.show),(o=>{const{images:a,startPosition:s}=e;o?(f(+s),Y((()=>{r(),z(+s,{immediate:!0})}))):t("close",{index:n.active,url:a[n.active]})})),()=>C(g,Z({class:[T(),e.className],overlayClass:T("overlay"),onClosed:S},o(e,["show","transition","overlayStyle","closeOnPopstate"]),{"onUpdate:show":v}),{default:()=>[x(),b(),w(),y()]})}});let $;const B={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};const O=(o,e=0)=>{if(a)return $||({instance:$}=r({setup(){const{state:o,toggle:e}=l(),t=()=>{o.images=[]};return()=>C(D,Z(o,{onClosed:t,"onUpdate:show":e}),null)}})),o=Array.isArray(o)?{images:o,startPosition:e}:o,$.open(s({},B,o)),$};O.Component=n(D),O.install=o=>{o.use(O.Component)};export{O as I};
