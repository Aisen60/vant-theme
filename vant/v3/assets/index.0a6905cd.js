import{c as e,t,E as a,p as i,z as l}from"./use-translate.91889477.js";import{w as o}from"./with-install.c9eedd0e.js";import{u as s}from"./use-touch.30351383.js";import{u as n}from"./use-expose.5ea79906.js";import{o as r}from"./on-popup-reopen.d7054786.js";import{i as u,d as v}from"./utils.b0356070.js";import{u as c}from"./index.94f7437a.js";import{D as h,z as p,E as d,C as f,x as m,G as g,P as w,N as b,O as y,e as x,q as C}from"./vue-libs.71fdcafc.js";import{u as S}from"./useChildren.edf9a3d1.js";import{u as j}from"./useParent.e4fd6deb.js";function z(){var e=h(u?window.innerWidth:0),t=h(u?window.innerHeight:0),a=()=>{e.value=window.innerWidth,t.value=window.innerHeight};return c("resize",a),c("orientationchange",a),{width:e,height:t}}const[$,M]=e("swipe"),T={loop:t,width:[Number,String],height:[Number,String],vertical:Boolean,touchable:t,lazyRender:Boolean,indicatorColor:String,showIndicators:t,stopPropagation:t,autoplay:{type:[Number,String],default:0},duration:{type:[Number,String],default:500},initialSwipe:{type:[Number,String],default:0}},N=Symbol($);const O=o(p({name:$,props:T,emits:["change"],setup(e,{emit:t,slots:o}){const p=h(),C=d({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),j=s(),$=z(),{children:T,linkChildren:O}=S(N),D=f((()=>T.length)),I=f((()=>C[e.vertical?"height":"width"])),P=f((()=>e.vertical?j.deltaY.value:j.deltaX.value)),X=f((()=>{if(C.rect){return(e.vertical?C.rect.height:C.rect.width)-I.value*D.value}return 0})),Y=f((()=>Math.ceil(Math.abs(X.value)/I.value))),k=f((()=>D.value*I.value)),E=f((()=>(C.active+D.value)%D.value)),H=f((()=>{const t=e.vertical?"vertical":"horizontal";return j.direction.value===t})),W=f((()=>{const t={transitionDuration:`${C.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${C.offset}px)`};if(I.value){const a=e.vertical?"height":"width",i=e.vertical?"width":"height";t[a]=`${k.value}px`,t[i]=e[i]?`${e[i]}px`:""}return t})),B=(t,a=0)=>{let i=t*I.value;e.loop||(i=Math.min(i,-X.value));let o=a-i;return e.loop||(o=l(o,X.value,0)),o},R=({pace:a=0,offset:i=0,emitChange:o})=>{if(D.value<=1)return;const{active:s}=C,n=(t=>{const{active:a}=C;return t?e.loop?l(a+t,-1,D.value):l(a+t,0,Y.value):a})(a),r=B(n,i);if(e.loop){if(T[0]&&r!==X.value){const e=r<X.value;T[0].setOffset(e?k.value:0)}if(T[D.value-1]&&0!==r){const e=r>0;T[D.value-1].setOffset(e?-k.value:0)}}C.active=n,C.offset=r,o&&n!==s&&t("change",E.value)},q=()=>{C.swiping=!0,C.active<=-1?R({pace:D.value}):C.active>=D.value&&R({pace:-D.value})},A=()=>{q(),j.reset(),v((()=>{C.swiping=!1,R({pace:1,emitChange:!0})}))};let G;const F=()=>clearTimeout(G),J=()=>{F(),e.autoplay>0&&D.value>1&&(G=setTimeout((()=>{A(),J()}),+e.autoplay))},K=(t=+e.initialSwipe)=>{var i,l;if(p.value){if(!a(p)){const t={width:p.value.offsetWidth,height:p.value.offsetHeight};C.rect=t,C.width=+(null!=(i=e.width)?i:t.width),C.height=+(null!=(l=e.height)?l:t.height)}D.value&&(t=Math.min(D.value-1,t)),C.active=t,C.swiping=!0,C.offset=B(t),T.forEach((e=>{e.setOffset(0)})),J()}},L=()=>K(C.active);let Q;const U=t=>{e.touchable&&(j.start(t),Q=Date.now(),F(),q())},V=t=>{e.touchable&&C.swiping&&(j.move(t),H.value&&(i(t,e.stopPropagation),R({offset:P.value})))},Z=()=>{if(!e.touchable||!C.swiping)return;const t=Date.now()-Q,a=P.value/t;if((Math.abs(a)>.25||Math.abs(P.value)>I.value/2)&&H.value){const t=e.vertical?j.offsetY.value:j.offsetX.value;let a=0;a=e.loop?t>0?P.value>0?-1:1:0:-Math[P.value>0?"ceil":"floor"](P.value/I.value),R({pace:a,emitChange:!0})}else P.value&&R({pace:0});C.swiping=!1,J()},_=(t,a)=>{const i=a===E.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return x("i",{style:l,class:M("indicator",{active:i})},null)};var ee,te;return n({prev:()=>{q(),j.reset(),v((()=>{C.swiping=!1,R({pace:-1,emitChange:!0})}))},next:A,state:C,resize:L,swipeTo:(t,a={})=>{q(),j.reset(),v((()=>{let i;i=e.loop&&t===D.value?0===C.active?0:t:t%D.value,a.immediate?v((()=>{C.swiping=!1})):C.swiping=!1,R({pace:i-C.active,emitChange:!0})}))}}),O({size:I,props:e,count:D,activeIndicator:E}),m((()=>e.initialSwipe),(e=>K(+e))),m(D,(()=>K(C.active))),m((()=>e.autoplay),J),m([$.width,$.height],L),m((ee=h("visible"),(te=()=>{u&&(ee.value=document.hidden?"hidden":"visible")})(),c("visibilitychange",te),ee),(e=>{"visible"===e?J():F()})),g(K),w((()=>K(C.active))),r((()=>K(C.active))),b(F),y(F),()=>{var t;return x("div",{ref:p,class:M()},[x("div",{style:W.value,class:M("track",{vertical:e.vertical}),onTouchstart:U,onTouchmove:V,onTouchend:Z,onTouchcancel:Z},[null==(t=o.default)?void 0:t.call(o)]),o.indicator?o.indicator({active:E.value}):e.showIndicators&&D.value>1?x("div",{class:M("indicators",{vertical:e.vertical})},[Array(D.value).fill("").map(_)]):void 0])}}})),[D,I]=e("swipe-item");const P=o(p({name:D,setup(e,{slots:t}){let a;const i=d({offset:0,inited:!1,mounted:!1}),{parent:l,index:o}=j(N);if(!l)return;const s=f((()=>{const e={},{vertical:t}=l.props;return l.size.value&&(e[t?"height":"width"]=`${l.size.value}px`),i.offset&&(e.transform=`translate${t?"Y":"X"}(${i.offset}px)`),e})),r=f((()=>{const{loop:e,lazyRender:t}=l.props;if(!t||a)return!0;if(!i.mounted)return!1;const s=l.activeIndicator.value,n=l.count.value-1,r=0===s&&e?n:s-1,u=s===n&&e?0:s+1;return a=o.value===s||o.value===r||o.value===u,a}));return g((()=>{C((()=>{i.mounted=!0}))})),n({setOffset:e=>{i.offset=e}}),()=>{var e;return x("div",{class:I(),style:s.value},[r.value?null==(e=t.default)?void 0:e.call(t):null])}}}));export{O as S,P as a,z as u};
