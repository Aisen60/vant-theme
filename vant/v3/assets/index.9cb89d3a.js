import{c as y,p as E,C as _}from"./use-translate.dc7c72f2.js";import{b as h,n as k,w}from"./with-install.eb95b9ca.js";import{u as A}from"./use-touch.89cea093.js";import{L as N}from"./index.5c5fe2f2.js";import{z as $,D as L,E as B,x as C,e as l,A as I,q as M}from"./vue-libs.84090ae0.js";import{u as O}from"./index.1b2e67e6.js";function R(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!I(e)}const[U,r,Y]=y("pull-refresh"),D=50,q=["pulling","loosing","success"];var z=$({name:U,props:{disabled:Boolean,modelValue:Boolean,headHeight:h(D),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:k,successDuration:h(500),animationDuration:h(300)},emits:["refresh","update:modelValue"],setup(e,{emit:m,slots:n}){let i;const g=L(),v=O(g),s=B({status:"normal",distance:0,duration:0}),u=A(),b=()=>{if(e.headHeight!==D)return{height:`${e.headHeight}px`}},d=()=>s.status!=="loading"&&s.status!=="success"&&!e.disabled,H=t=>{const a=+(e.pullDistance||e.headHeight);return t>a&&(t<a*2?t=a+(t-a)/2:t=a*1.5+(t-a*2)/4),Math.round(t)},o=(t,a)=>{const c=+(e.pullDistance||e.headHeight);s.distance=t,a?s.status="loading":t===0?s.status="normal":t<c?s.status="pulling":s.status="loosing"},T=()=>{const{status:t}=s;return t==="normal"?"":e[`${t}Text`]||Y(t)},j=()=>{const{status:t,distance:a}=s;if(n[t])return n[t]({distance:a});const c=[];if(q.includes(t)&&c.push(l("div",{class:r("text")},[T()])),t==="loading"){let f;c.push(l(N,{class:r("loading")},R(f=T())?f:{default:()=>[f]}))}return c},p=()=>{s.status="success",setTimeout(()=>{o(0)},+e.successDuration)},S=t=>{i=_(v.value)===0,i&&(s.duration=0,u.start(t))},P=t=>{d()&&S(t)},V=t=>{if(d()){i||S(t);const{deltaY:a}=u;u.move(t),i&&a.value>=0&&u.isVertical()&&(E(t),o(H(a.value)))}},x=()=>{i&&u.deltaY.value&&d()&&(s.duration=+e.animationDuration,s.status==="loosing"?(o(+e.headHeight,!0),m("update:modelValue",!0),M(()=>m("refresh"))):o(0))};return C(()=>e.modelValue,t=>{s.duration=+e.animationDuration,t?o(+e.headHeight,!0):n.success||e.successText?p():o(0,!1)}),()=>{var a;const t={transitionDuration:`${s.duration}ms`,transform:s.distance?`translate3d(0,${s.distance}px, 0)`:""};return l("div",{ref:g,class:r()},[l("div",{class:r("track"),style:t,onTouchstart:P,onTouchmove:V,onTouchend:x,onTouchcancel:x},[l("div",{class:r("head"),style:b()},[j()]),(a=n.default)==null?void 0:a.call(n)])])}}});const W=w(z);export{W as P};
