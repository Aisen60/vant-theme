import{c as H,b as oe,M as se,P as ce,Q as le,N as ue,l as re,D as R,R as z,u as ve}from"./use-translate.5cf29aa7.js";import{t as A,n as W,c as j,w as L}from"./with-install.28bb645f.js";import{u as fe}from"./use-touch.0cf4a6e6.js";import{u as V}from"./use-expose.e3e68c29.js";import{o as he}from"./on-popup-reopen.6de6ab9a.js";import{z as q,C as de,G,B as f,x as P,M as J,J as me,L as we,I as ge,e as C,q as pe}from"./vue-libs.cab43f37.js";const[K,$]=H("swipe"),be={loop:A,width:W,height:W,vertical:Boolean,autoplay:j(0),duration:j(500),touchable:A,lazyRender:Boolean,initialSwipe:j(0),indicatorColor:String,showIndicators:A,stopPropagation:A},Q=Symbol(K);var ye=q({name:K,props:be,emits:["change"],setup(a,{emit:b,slots:h}){const r=de(),e=G({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),c=fe(),{children:d,linkChildren:D}=oe(Q),i=f(()=>d.length),n=f(()=>e[a.vertical?"height":"width"]),u=f(()=>a.vertical?c.deltaY.value:c.deltaX.value),v=f(()=>e.rect?(a.vertical?e.rect.height:e.rect.width)-n.value*i.value:0),I=f(()=>Math.ceil(Math.abs(v.value)/n.value)),y=f(()=>i.value*n.value),g=f(()=>(e.active+i.value)%i.value),O=f(()=>{const t=a.vertical?"vertical":"horizontal";return c.direction.value===t}),U=f(()=>{const t={transitionDuration:`${e.swiping?0:a.duration}ms`,transform:`translate${a.vertical?"Y":"X"}(${e.offset}px)`};if(n.value){const s=a.vertical?"height":"width",o=a.vertical?"width":"height";t[s]=`${y.value}px`,t[o]=a[o]?`${a[o]}px`:""}return t}),F=t=>{const{active:s}=e;return t?a.loop?R(s+t,-1,i.value):R(s+t,0,I.value):s},B=(t,s=0)=>{let o=t*n.value;a.loop||(o=Math.min(o,-v.value));let l=s-o;return a.loop||(l=R(l,v.value,0)),l},m=({pace:t=0,offset:s=0,emitChange:o})=>{if(i.value<=1)return;const{active:l}=e,w=F(t),T=B(w,s);if(a.loop){if(d[0]&&T!==v.value){const k=T<v.value;d[0].setOffset(k?y.value:0)}if(d[i.value-1]&&T!==0){const k=T>0;d[i.value-1].setOffset(k?-y.value:0)}}e.active=w,e.offset=T,o&&w!==l&&b("change",g.value)},M=()=>{e.swiping=!0,e.active<=-1?m({pace:i.value}):e.active>=i.value&&m({pace:-i.value})},Z=()=>{M(),c.reset(),z(()=>{e.swiping=!1,m({pace:-1,emitChange:!0})})},Y=()=>{M(),c.reset(),z(()=>{e.swiping=!1,m({pace:1,emitChange:!0})})};let E;const x=()=>clearTimeout(E),S=()=>{x(),a.autoplay>0&&i.value>1&&(E=setTimeout(()=>{Y(),S()},+a.autoplay))},p=(t=+a.initialSwipe)=>{var s,o;if(!!r.value){if(!ue(r)){const l={width:r.value.offsetWidth,height:r.value.offsetHeight};e.rect=l,e.width=+((s=a.width)!=null?s:l.width),e.height=+((o=a.height)!=null?o:l.height)}i.value&&(t=Math.min(i.value-1,t)),e.active=t,e.swiping=!0,e.offset=B(t),d.forEach(l=>{l.setOffset(0)}),S()}},X=()=>p(e.active);let N;const ee=t=>{!a.touchable||(c.start(t),N=Date.now(),x(),M())},te=t=>{a.touchable&&e.swiping&&(c.move(t),(O.value||c.offsetY.value>c.offsetX.value===a.vertical)&&re(t,a.stopPropagation),O.value&&m({offset:u.value}))},_=()=>{if(!a.touchable||!e.swiping)return;const t=Date.now()-N,s=u.value/t;if((Math.abs(s)>.25||Math.abs(u.value)>n.value/2)&&O.value){const l=a.vertical?c.offsetY.value:c.offsetX.value;let w=0;a.loop?w=l>0?u.value>0?-1:1:0:w=-Math[u.value>0?"ceil":"floor"](u.value/n.value),m({pace:w,emitChange:!0})}else u.value&&m({pace:0});e.swiping=!1,S()},ae=(t,s={})=>{M(),c.reset(),z(()=>{let o;a.loop&&t===i.value?o=e.active===0?0:t:o=t%i.value,s.immediate?z(()=>{e.swiping=!1}):e.swiping=!1,m({pace:o-e.active,emitChange:!0})})},ie=(t,s)=>{const o=s===g.value,l=o?{backgroundColor:a.indicatorColor}:void 0;return C("i",{style:l,class:$("indicator",{active:o})},null)},ne=()=>{if(h.indicator)return h.indicator({active:g.value,total:i.value});if(a.showIndicators&&i.value>1)return C("div",{class:$("indicators",{vertical:a.vertical})},[Array(i.value).fill("").map(ie)])};return V({prev:Z,next:Y,state:e,resize:X,swipeTo:ae}),D({size:n,props:a,count:i,activeIndicator:g}),P(()=>a.initialSwipe,t=>p(+t)),P(i,()=>p(e.active)),P(()=>a.autoplay,S),P([se,ce],X),P(le(),t=>{t==="visible"?S():x()}),J(p),me(()=>p(e.active)),he(()=>p(e.active)),we(x),ge(x),()=>{var t;return C("div",{ref:r,class:$()},[C("div",{style:U.value,class:$("track",{vertical:a.vertical}),onTouchstart:ee,onTouchmove:te,onTouchend:_,onTouchcancel:_},[(t=h.default)==null?void 0:t.call(h)]),ne()])}}});const $e=L(ye),[xe,Se]=H("swipe-item");var Te=q({name:xe,setup(a,{slots:b}){let h;const r=G({offset:0,inited:!1,mounted:!1}),{parent:e,index:c}=ve(Q);if(!e)return;const d=f(()=>{const n={},{vertical:u}=e.props;return e.size.value&&(n[u?"height":"width"]=`${e.size.value}px`),r.offset&&(n.transform=`translate${u?"Y":"X"}(${r.offset}px)`),n}),D=f(()=>{const{loop:n,lazyRender:u}=e.props;if(!u||h)return!0;if(!r.mounted)return!1;const v=e.activeIndicator.value,I=e.count.value-1,y=v===0&&n?I:v-1,g=v===I&&n?0:v+1;return h=c.value===v||c.value===y||c.value===g,h}),i=n=>{r.offset=n};return J(()=>{pe(()=>{r.mounted=!0})}),V({setOffset:i}),()=>{var n;return C("div",{class:Se(),style:d.value},[D.value?(n=b.default)==null?void 0:n.call(b):null])}}});const De=L(Te);export{$e as S,De as a};
