import{c as e,e as a,t,l as s,a as o}from"./use-translate.b583725c.js";import{c as l,w as r}from"./with-install.62f47d2f.js";import{A as n,E as d,e as i,J as u,F as c,G as m,D as p,y as h,l as f,v as b,s as g,r as v,o as w,c as C,w as j,C as x}from"./vendor.ef334a89.js";import{u as y}from"./use-expose.33de0944.js";import{A as D,a as S}from"./index.b403545b.js";import{C as A}from"./index.550f913c.js";import{F as R}from"./index.3e32f020.js";import{P}from"./index.aa2914ba.js";import{T as B}from"./function-call.b2678465.js";import{B as F}from"./index.627ee112.js";import{D as M}from"./function-call.533d4529.js";import{S as V}from"./index.3ef909c5.js";import"./deep-clone.ba190482.js";import"./Picker.e16de937.js";import"./constant.4d85ecb9.js";import"./event.7d40caae.js";import"./unit.49c29796.js";import"./index.6fa13143.js";import"./number.b01aa591.js";import"./use-touch.ce80657e.js";import"./useParent.0a2f50cb.js";import"./useChildren.a94b5b99.js";import"./index.3a29a39b.js";import"./use-route.3fda2186.js";import"./index.3af24151.js";import"./index.49199c0d.js";import"./interceptor.ab1192d4.js";import"./index.7e292110.js";import"./utils.b0356070.js";import"./index.253cf6b3.js";import"./use-lazy-render.49349a00.js";import"./on-popup-reopen.522dc00c.js";import"./index.0acb7aaf.js";import"./mount-component.4a14b4e1.js";import"./index.1c8d237b.js";const[k,N,I]=l("address-edit-detail");var U=n({name:k,props:{show:Boolean,value:String,focused:Boolean,detailRows:[Number,String],searchResult:Array,errorMessage:String,detailMaxlength:[Number,String],showSearchResult:Boolean},emits:["blur","focus","input","select-search"],setup(e,{emit:a}){const t=d(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,o=()=>{if(!s())return;const{searchResult:t}=e;return t.map((t=>i(A,{clickable:!0,key:t.name+t.address,icon:"location-o",label:t.address,class:N("search-item"),border:!1,onClick:()=>(e=>{a("select-search",e),a("input",`${e.address||""} ${e.name||""}`.trim())})(t)},{title:()=>(a=>{if(a.name){const t=a.name.replace(e.value,`<span class=${N("keyword")}>${e.value}</span>`);return i("div",{innerHTML:t},null)}})(t)})))},l=e=>a("blur",e),r=e=>a("focus",e),n=e=>a("input",e);return()=>{if(e.show)return i(c,null,[i(R,u({autosize:!0,clearable:!0,ref:t,class:N(),rows:e.detailRows,type:"textarea",label:I("label"),border:!s(),maxlength:e.detailMaxlength,modelValue:e.value,placeholder:I("placeholder"),errorMessage:e.errorMessage,onBlur:l,onFocus:r},{"onUpdate:modelValue":n}),null),o()])}}});const[L,T,E]=l("address-edit"),z={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,postalCode:"",addressDetail:""};const $=r(n({name:L,props:{areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:t,showDetail:t,showDelete:Boolean,showPostal:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:[Number,String],showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:{type:[Number,String],default:1},detailMaxlength:{type:[Number,String],default:200},addressInfo:{type:Object,default:()=>a({},z)},telValidator:{type:Function,default:s},postalValidator:{type:Function,default:function(e){return/^\d{6}$/.test(e)}},areaColumnsPlaceholder:{type:Array,default:()=>[]}},emits:["save","focus","delete","click-area","change-area","change-detail","cancel-delete","select-search","change-default"],setup(t,{emit:s,slots:o}){const l=d(),r=m({data:{},showAreaPopup:!1,detailFocused:!1,errorInfo:{tel:"",name:"",areaCode:"",postalCode:"",addressDetail:""}}),n=p((()=>e(t.areaList)&&Object.keys(t.areaList).length)),u=p((()=>{const{country:e,province:a,city:t,county:s,areaCode:o}=r.data;if(o){const o=[e,a,t,s];return a&&a===t&&o.splice(1,1),o.filter(Boolean).join("/")}return""})),c=p((()=>{var e;return(null==(e=t.searchResult)?void 0:e.length)&&r.detailFocused})),v=()=>{if(l.value){const e=l.value.getArea();e.areaCode=e.code,delete e.code,a(r.data,e)}},w=e=>{r.errorInfo[e]="",r.detailFocused="addressDetail"===e,s("focus",e)},C=()=>{const e=["name","tel"];t.showArea&&e.push("areaCode"),t.showDetail&&e.push("addressDetail"),t.showPostal&&e.push("postalCode");e.every((e=>{const a=(e=>{const a=String(r.data[e]||"").trim();if(t.validator){const s=t.validator(e,a);if(s)return s}switch(e){case"name":return a?"":E("nameEmpty");case"tel":return t.telValidator(a)?"":E("telInvalid");case"areaCode":return a?"":E("areaEmpty");case"addressDetail":return a?"":E("addressEmpty");case"postalCode":return a&&!t.postalValidator(a)?E("postalEmpty"):""}})(e);return a&&(r.errorInfo[e]=a),!a}))&&!t.isSaving&&s("save",r.data)},j=e=>{r.data.addressDetail=e,s("change-detail",e)},x=e=>{(e=e.filter(Boolean)).some((e=>!e.code))?B(E("areaEmpty")):(r.showAreaPopup=!1,v(),s("change-area",e))},S=()=>{M.confirm({title:E("confirmDelete")}).then((()=>s("delete",r.data))).catch((()=>s("cancel-delete",r.data)))},k=e=>{r.data.areaCode=e||"",e&&g(v)},N=()=>{setTimeout((()=>{r.detailFocused=!1}))},I=()=>{if(t.showSetDefault){const e={"right-icon":()=>i(V,{modelValue:r.data.isDefault,"onUpdate:modelValue":e=>r.data.isDefault=e,size:"24",onChange:e=>s("change-default",e)},null)};return f(i(A,{center:!0,title:E("defaultAddress"),class:T("default")},e),[[b,!c.value]])}return null};return y({getArea:()=>l.value?l.value.getValues():[],setAreaCode:k,setAddressDetail:e=>{r.data.addressDetail=e}}),h((()=>t.areaList),(()=>k(r.data.areaCode))),h((()=>t.addressInfo),(e=>{r.data=a({},z,e),k(e.areaCode)}),{deep:!0,immediate:!0}),()=>{var e;const{data:a,errorInfo:d}=r,{disableArea:m}=t;return i("div",{class:T()},[i("div",{class:T("fields")},[i(R,{modelValue:a.name,"onUpdate:modelValue":e=>a.name=e,clearable:!0,label:E("name"),placeholder:E("name"),errorMessage:d.name,onFocus:()=>w("name")},null),i(R,{modelValue:a.tel,"onUpdate:modelValue":e=>a.tel=e,clearable:!0,type:"tel",label:E("tel"),maxlength:t.telMaxlength,placeholder:E("tel"),errorMessage:d.tel,onFocus:()=>w("tel")},null),f(i(R,{readonly:!0,label:E("area"),"is-link":!m,modelValue:u.value,placeholder:t.areaPlaceholder||E("area"),errorMessage:d.areaCode,onFocus:()=>w("areaCode"),onClick:()=>{s("click-area"),r.showAreaPopup=!m}},null),[[b,t.showArea]]),i(U,{show:t.showDetail,value:a.addressDetail,focused:r.detailFocused,detailRows:t.detailRows,errorMessage:d.addressDetail,searchResult:t.searchResult,detailMaxlength:t.detailMaxlength,showSearchResult:t.showSearchResult,onBlur:N,onFocus:()=>w("addressDetail"),onInput:j,"onSelect-search":e=>s("select-search",e)},null),t.showPostal&&f(i(R,{modelValue:a.postalCode,"onUpdate:modelValue":e=>a.postalCode=e,type:"tel",label:E("postal"),maxlength:"6",placeholder:E("postal"),errorMessage:d.postalCode,onFocus:()=>w("postalCode")},null),[[b,!c.value]]),null==(e=o.default)?void 0:e.call(o)]),I(),f(i("div",{class:T("buttons")},[i(F,{block:!0,round:!0,type:"danger",text:t.saveButtonText||E("save"),class:T("button"),loading:t.isSaving,onClick:C},null),t.showDelete&&i(F,{block:!0,round:!0,class:T("button"),loading:t.isDeleting,text:t.deleteButtonText||E("delete"),onClick:S},null)]),[[b,!c.value]]),i(P,{show:r.showAreaPopup,"onUpdate:show":e=>r.showAreaPopup=e,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[i(D,{ref:l,value:a.areaCode,loading:!n.value,areaList:t.areaList,columnsPlaceholder:t.areaColumnsPlaceholder,onConfirm:x,onCancel:()=>{r.showAreaPopup=!1}},null)]})])}}}));const O=n({setup(e){const a=o({"zh-CN":{areaColumnsPlaceholder:["请选择","请选择","请选择"],searchResult:[{name:"黄龙万科中心",address:"杭州市西湖区"},{name:"黄龙万科中心G座"},{name:"黄龙万科中心H座",address:"杭州市西湖区"}]},"en-US":{areaColumnsPlaceholder:["Choose","Choose","Choose"],searchResult:[{name:"Name1",address:"Address"},{name:"Name2"},{name:"Name3",address:"Address"}]}}),t=d([]),s=()=>B(a("save")),l=()=>B(a("delete")),r=e=>{t.value=e?a("searchResult"):[]};return(e,o)=>{const n=v("demo-block");return w(),C(n,{title:x(a)("basicUsage")},{default:j((()=>[i(x($),{"area-list":x(S),"show-postal":"","show-delete":"","show-set-default":"","show-search-result":"","search-result":t.value,"area-columns-placeholder":x(a)("areaColumnsPlaceholder"),onSave:s,onDelete:l,onChangeDetail:r},null,8,["area-list","search-result","area-columns-placeholder"])])),_:1},8,["title"])}}});export{O as default};
