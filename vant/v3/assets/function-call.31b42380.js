import{c as D,l as N,D as y,M as U,P as K,p as Q,G as J,d as ee,e as oe}from"./use-translate.c431c781.js";import{d as j,n as k,t as Y,b as te,c as H,u as ae,m as A,w as se}from"./with-install.6654422d.js";import{m as ne,u as ie}from"./mount-component.3889b323.js";import{H as ce}from"./constant.80c6de18.js";import{c as le}from"./interceptor.17973404.js";import{u as re}from"./use-expose.cd1f8e82.js";import{I as me}from"./index.73431c4d.js";import{a as ue,S as de}from"./index.1524e218.js";import{P as fe}from"./index.949f0f09.js";import{u as ve}from"./use-touch.0cf4a6e6.js";import{I as ge}from"./index.4fc74d62.js";import{L as he}from"./index.7c2cb6fe.js";import{z as $,G as B,B as z,x as b,e as r,C as we,M as pe,q as Pe,P as xe,Q as O}from"./vue-libs.cab43f37.js";const E=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),_=D("image-preview")[1];var Ie=$({props:{src:String,show:Boolean,active:Number,minZoom:j(k),maxZoom:j(k),rootWidth:j(Number),rootHeight:j(Number)},emits:["scale","close"],setup(e,{emit:c}){const o=B({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=ve(),i=z(()=>{const{rootWidth:t,rootHeight:s}=e,n=s/t;return o.imageRatio>n}),S=z(()=>{const{scale:t,moveX:s,moveY:n,moving:u,zooming:x}=o,X={transitionDuration:x||u?"0s":".3s"};if(t!==1){const V=s/t,G=n/t;X.transform=`scale(${t}, ${t}) translate(${V}px, ${G}px)`}return X}),h=z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,n=i.value?s/o.imageRatio:t;return Math.max(0,(o.scale*n-t)/2)}return 0}),d=z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,n=i.value?s:t*o.imageRatio;return Math.max(0,(o.scale*n-s)/2)}return 0}),w=t=>{t=y(t,+e.minZoom,+e.maxZoom),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},f=()=>{w(1),o.moveX=0,o.moveY=0},R=()=>{const t=o.scale>1?1:2;w(t),o.moveX=0,o.moveY=0};let p,P,C,T,m,a;const v=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),p=o.moveX,P=o.moveY,a=Date.now(),o.moving=s.length===1&&o.scale!==1,o.zooming=s.length===2&&!n.value,o.zooming&&(C=o.scale,T=E(t.touches))},g=t=>{const{touches:s}=t;if(l.move(t),(o.moving||o.zooming)&&N(t,!0),o.moving){const{deltaX:n,deltaY:u}=l,x=n.value+p,X=u.value+P;o.moveX=y(x,-h.value,h.value),o.moveY=y(X,-d.value,d.value)}if(o.zooming&&s.length===2){const n=E(s),u=C*n/T;w(u)}},L=()=>{const{offsetX:t,offsetY:s}=l,n=Date.now()-a,u=250,x=10;t.value<x&&s.value<x&&n<u&&(m?(clearTimeout(m),m=null,R()):m=setTimeout(()=>{c("close"),m=null},u))},Z=t=>{let s=!1;(o.moving||o.zooming)&&(s=!0,o.moving&&p===o.moveX&&P===o.moveY&&(s=!1),t.touches.length||(o.zooming&&(o.moveX=y(o.moveX,-h.value,h.value),o.moveY=y(o.moveY,-d.value,d.value),o.zooming=!1),o.moving=!1,p=0,P=0,C=1,o.scale<1&&f())),N(t,s),L(),l.reset()},q=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;o.imageRatio=n/s};return b(()=>e.active,f),b(()=>e.show,t=>{t||f()}),()=>{const t={loading:()=>r(he,{type:"spinner"},null)};return r(ue,{class:_("swipe-item"),onTouchstart:v,onTouchmove:g,onTouchend:Z,onTouchcancel:Z},{default:()=>[r(ge,{src:e.src,fit:"contain",class:_("image",{vertical:i.value}),style:S.value,onLoad:q},t)]})}}});function Se(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!xe(e)}const[Ce,I]=D("image-preview"),ye=["show","transition","overlayStyle","closeOnPopstate"],be={show:Boolean,loop:Y,images:te(),minZoom:H(1/3),maxZoom:H(3),overlay:Y,closeable:Boolean,showIndex:Y,className:ae,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayStyle:Object,swipeDuration:H(300),startPosition:H(0),showIndicators:Boolean,closeOnPopstate:Y,closeIconPosition:A("top-right")};var F=$({name:Ce,props:be,emits:["scale","close","closed","change","update:show"],setup(e,{emit:c,slots:o}){const l=we(),i=B({active:0,rootWidth:0,rootHeight:0}),S=()=>{if(l.value){const a=J(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},h=a=>c("scale",a),d=a=>c("update:show",a),w=()=>{le(e.beforeClose,{args:[i.active],done:()=>d(!1)})},f=a=>{a!==i.active&&(i.active=a,c("change",a))},R=()=>{if(e.showIndex)return r("div",{class:I("index")},[o.index?o.index({index:i.active}):`${i.active+1} / ${e.images.length}`])},p=()=>{if(o.cover)return r("div",{class:I("cover")},[o.cover()])},P=()=>{let a;return r(de,{ref:l,lazyRender:!0,loop:e.loop,class:I("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:f},Se(a=e.images.map(v=>r(Ie,{src:v,show:e.show,active:i.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:h,onClose:w},null)))?a:{default:()=>[a]})},C=()=>{if(e.closeable)return r(me,{role:"button",name:e.closeIcon,class:[I("close-icon",e.closeIconPosition),ce],onClick:w},null)},T=()=>c("closed"),m=(a,v)=>{var g;return(g=l.value)==null?void 0:g.swipeTo(a,v)};return re({swipeTo:m}),pe(S),b([U,K],S),b(()=>e.startPosition,a=>f(+a)),b(()=>e.show,a=>{const{images:v,startPosition:g}=e;a?(f(+g),Pe(()=>{S(),m(+g,{immediate:!0})})):c("close",{index:i.active,url:v[i.active]})}),()=>r(fe,O({class:[I(),e.className],overlayClass:I("overlay"),onClosed:T,"onUpdate:show":d},Q(e,ye)),{default:()=>[C(),P(),R(),p()]})}});let M;const Te={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Xe(){({instance:M}=ne({setup(){const{state:e,toggle:c}=ie(),o=()=>{e.images=[]};return()=>r(F,O(e,{onClosed:o,"onUpdate:show":c}),null)}}))}const W=(e,c=0)=>{if(!!ee)return M||Xe(),e=Array.isArray(e)?{images:e,startPosition:c}:e,M.open(oe({},Te,e)),M};W.Component=se(F);W.install=e=>{e.use(W.Component)};export{W as I};
