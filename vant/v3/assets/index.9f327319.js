import{h as _,e as H,c as F,i as K}from"./use-translate.33b17133.js";import{n as x,t as b,u as M,m as I,w as N}from"./with-install.d00852e2.js";import{N as O,O as Y,x as j,z as G,C as S,B as U,E as V,P as $,J,e as f,T as Q,Q as Z,F as q,j as W,v as X,H as ee}from"./vue-libs.7d3cdfcb.js";import{H as oe}from"./constant.80c6de18.js";import{c as te}from"./interceptor.926f5054.js";import{u as ne}from"./use-expose.e553b263.js";import{u as se}from"./use-touch.ac1b49d9.js";import{o as ae,u as ce}from"./index.ba1bb458.js";import{g as re}from"./index.71250a43.js";import{u as le}from"./use-lazy-render.cbcc62ed.js";import{P as ie}from"./on-popup-reopen.aa8649f1.js";import{I as ue}from"./index.0a08d1ef.js";import{O as de}from"./index.89fdf2f6.js";const g={show:Boolean,zIndex:x,overlay:b,duration:x,teleport:[String,Object],lockScroll:b,lazyRender:b,beforeClose:Function,overlayStyle:Object,overlayClass:M,transitionAppear:Boolean,closeOnClickOverlay:b},ze=Object.keys(g);let p=0;const z="van-overflow-hidden";function fe(e,t){const s=se(),a=r=>{s.move(r);const k=s.deltaY.value>0?"10":"01",h=re(r.target,e.value),{scrollHeight:l,offsetHeight:y,scrollTop:v}=h;let u="11";v===0?u=y>=l?"00":"01":v+y>=l&&(u="10"),u!=="11"&&s.isVertical()&&!(parseInt(u,2)&parseInt(k,2))&&_(r,!0)},n=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",a,{passive:!1}),p||document.body.classList.add(z),p++},c=()=>{p&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",a),p--,p||document.body.classList.remove(z))},m=()=>t()&&n(),i=()=>t()&&c();ae(m),O(i),Y(i),j(t,r=>{r?n():c()})}const me=H({},g,{round:Boolean,position:I("center"),closeIcon:I("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:I("top-right"),safeAreaInsetBottom:Boolean}),[ve,A]=F("popup");let B=2e3;var pe=G({name:ve,inheritAttrs:!1,props:me,emits:["open","close","click","opened","closed","update:show","click-overlay","click-close-icon"],setup(e,{emit:t,attrs:s,slots:a}){let n,c;const m=S(),i=S(),r=le(()=>e.show||!e.lazyRender),k=U(()=>{const o={zIndex:m.value};if(K(e.duration)){const d=e.position==="center"?"animationDuration":"transitionDuration";o[d]=`${e.duration}s`}return o}),h=()=>{n||(e.zIndex!==void 0&&(B=+e.zIndex),n=!0,m.value=++B,t("open"))},l=()=>{n&&te(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},y=o=>{t("click-overlay",o),e.closeOnClickOverlay&&l()},v=()=>{if(e.overlay)return f(de,{show:e.show,class:e.overlayClass,zIndex:m.value,duration:e.duration,customStyle:e.overlayStyle,onClick:y},{default:a["overlay-content"]})},u=o=>{t("click-close-icon",o),l()},E=()=>{if(e.closeable)return f(ue,{role:"button",tabindex:0,name:e.closeIcon,class:[A("close-icon",e.closeIconPosition),oe],classPrefix:e.iconPrefix,onClick:u},null)},L=o=>t("click",o),T=()=>t("opened"),D=()=>t("closed"),R=r(()=>{var P;const{round:o,position:d,safeAreaInsetBottom:C}=e;return W(f("div",ee({ref:i,style:k.value,class:[A({round:o,[d]:d}),{"van-safe-area-bottom":C}],onClick:L},s),[(P=a.default)==null?void 0:P.call(a),E()]),[[X,e.show]])}),w=()=>{const{position:o,transition:d,transitionAppear:C}=e,P=o==="center"?"van-fade":`van-popup-slide-${o}`;return f(Q,{name:d||P,appear:C,onAfterEnter:T,onAfterLeave:D},{default:R})};return j(()=>e.show,o=>{o?h():(n=!1,t("close"))}),ne({popupRef:i}),fe(i,()=>e.show&&e.lockScroll),ce("popstate",()=>{e.closeOnPopstate&&(l(),c=!1)}),V(()=>{e.show&&h()}),$(()=>{c&&(t("update:show",!0),c=!1)}),O(()=>{e.show&&(l(),c=!0)}),J(ie,()=>e.show),()=>e.teleport?f(Z,{to:e.teleport},{default:()=>[v(),w()]}):f(q,null,[v(),w()])}});const Ae=N(pe);export{Ae as P,ze as a,g as p};
