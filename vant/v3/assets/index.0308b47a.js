import{c as W,L as se,b as ce,P as le,N as ue,m as re,D as j,Q as A,u as ve}from"./use-translate.43484c14.js";import{t as M,n as H,c as B,w as V}from"./with-install.d47ea1a2.js";import{u as fe}from"./use-touch.8e5a0907.js";import{u as q}from"./use-expose.f4ec549a.js";import{o as he}from"./on-popup-reopen.4b166a39.js";import{z as G,C as de,G as J,B as v,x as T,M as K,J as me,L as we,I as ge,e as C,q as pe}from"./vue-libs.f710b8ed.js";const[Q,$]=W("swipe"),be={loop:M,width:H,height:H,vertical:Boolean,autoplay:B(0),duration:B(500),touchable:M,lazyRender:Boolean,initialSwipe:B(0),indicatorColor:String,showIndicators:M,stopPropagation:M},U=Symbol(Q);var ye=G({name:Q,props:be,emits:["change"],setup(a,{emit:p,slots:f}){const r=de(),e=J({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),c=fe(),P=se(),{children:h,linkChildren:D}=ce(U),i=v(()=>h.length),l=v(()=>e[a.vertical?"height":"width"]),u=v(()=>a.vertical?c.deltaY.value:c.deltaX.value),d=v(()=>e.rect?(a.vertical?e.rect.height:e.rect.width)-l.value*i.value:0),O=v(()=>Math.ceil(Math.abs(d.value)/l.value)),b=v(()=>i.value*l.value),z=v(()=>(e.active+i.value)%i.value),R=v(()=>{const t=a.vertical?"vertical":"horizontal";return c.direction.value===t}),F=v(()=>{const t={transitionDuration:`${e.swiping?0:a.duration}ms`,transform:`translate${a.vertical?"Y":"X"}(${e.offset}px)`};if(l.value){const o=a.vertical?"height":"width",n=a.vertical?"width":"height";t[o]=`${b.value}px`,t[n]=a[n]?`${a[n]}px`:""}return t}),Z=t=>{const{active:o}=e;return t?a.loop?j(o+t,-1,i.value):j(o+t,0,O.value):o},E=(t,o=0)=>{let n=t*l.value;a.loop||(n=Math.min(n,-d.value));let s=o-n;return a.loop||(s=j(s,d.value,0)),s},m=({pace:t=0,offset:o=0,emitChange:n})=>{if(i.value<=1)return;const{active:s}=e,w=Z(t),x=E(w,o);if(a.loop){if(h[0]&&x!==d.value){const k=x<d.value;h[0].setOffset(k?b.value:0)}if(h[i.value-1]&&x!==0){const k=x>0;h[i.value-1].setOffset(k?-b.value:0)}}e.active=w,e.offset=x,n&&w!==s&&p("change",z.value)},I=()=>{e.swiping=!0,e.active<=-1?m({pace:i.value}):e.active>=i.value&&m({pace:-i.value})},ee=()=>{I(),c.reset(),A(()=>{e.swiping=!1,m({pace:-1,emitChange:!0})})},Y=()=>{I(),c.reset(),A(()=>{e.swiping=!1,m({pace:1,emitChange:!0})})};let N;const y=()=>clearTimeout(N),S=()=>{y(),a.autoplay>0&&i.value>1&&(N=setTimeout(()=>{Y(),S()},+a.autoplay))},g=(t=+a.initialSwipe)=>{var o,n;if(!!r.value){if(!ue(r)){const s={width:r.value.offsetWidth,height:r.value.offsetHeight};e.rect=s,e.width=+((o=a.width)!=null?o:s.width),e.height=+((n=a.height)!=null?n:s.height)}i.value&&(t=Math.min(i.value-1,t)),e.active=t,e.swiping=!0,e.offset=E(t),h.forEach(s=>{s.setOffset(0)}),S()}},X=()=>g(e.active);let _;const te=t=>{!a.touchable||(c.start(t),_=Date.now(),y(),I())},ae=t=>{a.touchable&&e.swiping&&(c.move(t),R.value&&(re(t,a.stopPropagation),m({offset:u.value})))},L=()=>{if(!a.touchable||!e.swiping)return;const t=Date.now()-_,o=u.value/t;if((Math.abs(o)>.25||Math.abs(u.value)>l.value/2)&&R.value){const s=a.vertical?c.offsetY.value:c.offsetX.value;let w=0;a.loop?w=s>0?u.value>0?-1:1:0:w=-Math[u.value>0?"ceil":"floor"](u.value/l.value),m({pace:w,emitChange:!0})}else u.value&&m({pace:0});e.swiping=!1,S()},ie=(t,o={})=>{I(),c.reset(),A(()=>{let n;a.loop&&t===i.value?n=e.active===0?0:t:n=t%i.value,o.immediate?A(()=>{e.swiping=!1}):e.swiping=!1,m({pace:n-e.active,emitChange:!0})})},ne=(t,o)=>{const n=o===z.value,s=n?{backgroundColor:a.indicatorColor}:void 0;return C("i",{style:s,class:$("indicator",{active:n})},null)},oe=()=>{if(f.indicator)return f.indicator({active:z.value});if(a.showIndicators&&i.value>1)return C("div",{class:$("indicators",{vertical:a.vertical})},[Array(i.value).fill("").map(ne)])};return q({prev:ee,next:Y,state:e,resize:X,swipeTo:ie}),D({size:l,props:a,count:i,activeIndicator:z}),T(()=>a.initialSwipe,t=>g(+t)),T(i,()=>g(e.active)),T(()=>a.autoplay,S),T([P.width,P.height],X),T(le(),t=>{t==="visible"?S():y()}),K(g),me(()=>g(e.active)),he(()=>g(e.active)),we(y),ge(y),()=>{var t;return C("div",{ref:r,class:$()},[C("div",{style:F.value,class:$("track",{vertical:a.vertical}),onTouchstart:te,onTouchmove:ae,onTouchend:L,onTouchcancel:L},[(t=f.default)==null?void 0:t.call(f)]),oe()])}}});const $e=V(ye),[Se,xe]=W("swipe-item");var Te=G({name:Se,setup(a,{slots:p}){let f;const r=J({offset:0,inited:!1,mounted:!1}),{parent:e,index:c}=ve(U);if(!e)return;const P=v(()=>{const i={},{vertical:l}=e.props;return e.size.value&&(i[l?"height":"width"]=`${e.size.value}px`),r.offset&&(i.transform=`translate${l?"Y":"X"}(${r.offset}px)`),i}),h=v(()=>{const{loop:i,lazyRender:l}=e.props;if(!l||f)return!0;if(!r.mounted)return!1;const u=e.activeIndicator.value,d=e.count.value-1,O=u===0&&i?d:u-1,b=u===d&&i?0:u+1;return f=c.value===u||c.value===O||c.value===b,f}),D=i=>{r.offset=i};return K(()=>{pe(()=>{r.mounted=!0})}),q({setOffset:D}),()=>{var i;return C("div",{class:xe(),style:P.value},[h.value?(i=p.default)==null?void 0:i.call(p):null])}}});const De=V(Te);export{$e as S,De as a};
