import{c as M,n as N,p as $,C as T,r as U,t as z,s as W,u as G,m as k,b as J,e as K}from"./use-translate.e667ce10.js";import{w as Q}from"./with-install.feb19484.js";import{m as ee,u as oe}from"./mount-component.553013ae.js";import{c as te}from"./interceptor.b759bdc5.js";import{u as ae}from"./use-expose.9b0dd301.js";import{I as ne}from"./index.472ff4df.js";import{a as se,u as ie,S as ce}from"./index.d7333b46.js";import{P as re}from"./index.13873f42.js";import{u as le}from"./use-touch.b0c07ae6.js";import{I as me}from"./index.b7f6e1af.js";import{L as ue}from"./index.ae867a8e.js";import{z as A,E as O,C as Z,x as X,e as l,D as de,G as fe,q as ve,A as ge,I as q}from"./vue-libs.1dda7261.js";const B=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),E=M("image-preview")[1];var he=A({props:{src:String,show:Boolean,active:Number,minZoom:{type:N,required:!0},maxZoom:{type:N,required:!0},rootWidth:{type:Number,required:!0},rootHeight:{type:Number,required:!0}},emits:["scale","close"],setup(e,{emit:c}){const o=O({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),r=le(),g=Z(()=>{const{rootWidth:t,rootHeight:n}=e,s=n/t;return o.imageRatio>s}),i=Z(()=>{const{scale:t,moveX:n,moveY:s,moving:u,zooming:y}=o,j={transitionDuration:y||u?"0s":".3s"};if(t!==1){const F=n/t,V=s/t;j.transform=`scale(${t}, ${t}) translate(${F}px, ${V}px)`}return j}),m=Z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:n}=e,s=g.value?n/o.imageRatio:t;return Math.max(0,(o.scale*s-t)/2)}return 0}),h=Z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:n}=e,s=g.value?n:t*o.imageRatio;return Math.max(0,(o.scale*s-n)/2)}return 0}),w=t=>{t=T(t,+e.minZoom,+e.maxZoom),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},p=()=>{w(1),o.moveX=0,o.moveY=0},b=()=>{const t=o.scale>1?1:2;w(t),o.moveX=0,o.moveY=0};let x,I,P,Y,d,C;const a=t=>{const{touches:n}=t,{offsetX:s}=r;r.start(t),x=o.moveX,I=o.moveY,C=Date.now(),o.moving=n.length===1&&o.scale!==1,o.zooming=n.length===2&&!s.value,o.zooming&&(P=o.scale,Y=B(t.touches))},f=t=>{const{touches:n}=t;if(r.move(t),(o.moving||o.zooming)&&$(t,!0),o.moving){const{deltaX:s,deltaY:u}=r,y=s.value+x,j=u.value+I;o.moveX=T(y,-m.value,m.value),o.moveY=T(j,-h.value,h.value)}if(o.zooming&&n.length===2){const s=B(n),u=P*s/Y;w(u)}},v=()=>{const{offsetX:t,offsetY:n}=r,s=Date.now()-C,u=250,y=10;t.value<y&&n.value<y&&s<u&&(d?(clearTimeout(d),d=null,b()):d=setTimeout(()=>{c("close"),d=null},u))},D=t=>{let n=!1;(o.moving||o.zooming)&&(n=!0,o.moving&&x===o.moveX&&I===o.moveY&&(n=!1),t.touches.length||(o.zooming&&(o.moveX=T(o.moveX,-m.value,m.value),o.moveY=T(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,x=0,I=0,P=1,o.scale<1&&p())),$(t,n),v(),r.reset()},_=t=>{const{naturalWidth:n,naturalHeight:s}=t.target;o.imageRatio=s/n};return X(()=>e.active,p),X(()=>e.show,t=>{t||p()}),()=>{const t={loading:()=>l(ue,{type:"spinner"},null)};return l(se,{class:E("swipe-item"),onTouchstart:a,onTouchmove:f,onTouchend:D,onTouchcancel:D},{default:()=>[l(me,{src:e.src,fit:"contain",class:E("image",{vertical:g.value}),style:i.value,onLoad:_},t)]})}}});function we(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ge(e)}const[pe,S]=M("image-preview"),xe={show:Boolean,loop:z,minZoom:W(1/3),maxZoom:W(3),overlay:z,closeable:Boolean,showIndex:z,className:G,closeIcon:k("clear"),transition:String,beforeClose:Function,overlayStyle:Object,swipeDuration:W(300),startPosition:W(0),showIndicators:Boolean,closeOnPopstate:z,closeIconPosition:k("top-right"),images:{type:Array,default:()=>[]}};var L=A({name:pe,props:xe,emits:["scale","close","closed","change","update:show"],setup(e,{emit:c,slots:o}){const r=de(),g=ie(),i=O({active:0,rootWidth:0,rootHeight:0}),m=()=>{if(r.value){const a=r.value.$el.getBoundingClientRect();i.rootWidth=a.width,i.rootHeight=a.height,r.value.resize()}},h=a=>c("scale",a),w=a=>c("update:show",a),p=()=>{te({interceptor:e.beforeClose,args:[i.active],done:()=>w(!1)})},b=a=>{a!==i.active&&(i.active=a,c("change",a))},x=()=>{if(e.showIndex)return l("div",{class:S("index")},[o.index?o.index({index:i.active}):`${i.active+1} / ${e.images.length}`])},I=()=>{if(o.cover)return l("div",{class:S("cover")},[o.cover()])},P=()=>{let a;return l(ce,{ref:r,lazyRender:!0,loop:e.loop,class:S("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:b},we(a=e.images.map(f=>l(he,{src:f,show:e.show,active:i.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:h,onClose:p},null)))?a:{default:()=>[a]})},Y=()=>{if(e.closeable)return l(ne,{role:"button",name:e.closeIcon,class:S("close-icon",e.closeIconPosition),onClick:p},null)},d=()=>c("closed"),C=(a,f)=>{var v;return(v=r.value)==null?void 0:v.swipeTo(a,f)};return ae({swipeTo:C}),fe(m),X([g.width,g.height],m),X(()=>e.startPosition,a=>b(+a)),X(()=>e.show,a=>{const{images:f,startPosition:v}=e;a?(b(+v),ve(()=>{m(),C(+v,{immediate:!0})})):c("close",{index:i.active,url:f[i.active]})}),()=>l(re,q({class:[S(),e.className],overlayClass:S("overlay"),onClosed:d},U(e,["show","transition","overlayStyle","closeOnPopstate"]),{"onUpdate:show":w}),{default:()=>[Y(),P(),x(),I()]})}});let H;const Ie={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function ye(){({instance:H}=ee({setup(){const{state:e,toggle:c}=oe(),o=()=>{e.images=[]};return()=>l(L,q(e,{onClosed:o,"onUpdate:show":c}),null)}}))}const R=(e,c=0)=>{if(!!J)return H||ye(),e=Array.isArray(e)?{images:e,startPosition:c}:e,H.open(K({},Ie,e)),H};R.Component=Q(L);R.install=e=>{e.use(R.Component)};export{R as I};
