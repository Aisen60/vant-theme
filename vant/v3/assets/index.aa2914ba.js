import{t as e,u as o,e as t,i as s}from"./use-translate.b583725c.js";import{c as a,w as n}from"./with-install.62f47d2f.js";import{O as r,P as l,y as i,A as c,E as p,D as u,H as d,Q as m,M as f,e as v,T as y,B as h,R as b,F as j,l as w,v as x,J as g}from"./vendor.ef334a89.js";import{c as k}from"./interceptor.ab1192d4.js";import{u as I}from"./use-expose.33de0944.js";import{u as S}from"./use-touch.ce80657e.js";import{p as O}from"./event.7d40caae.js";import{o as P,s as B,u as C}from"./index.7e292110.js";import{g as z}from"./index.253cf6b3.js";import{u as A}from"./use-lazy-render.49349a00.js";import{P as L}from"./on-popup-reopen.522dc00c.js";import{I as E}from"./index.3af24151.js";import{O as R}from"./index.0acb7aaf.js";const D={show:Boolean,zIndex:[Number,String],overlay:e,duration:[Number,String],teleport:[String,Object],lockScroll:e,lazyRender:e,beforeClose:Function,overlayStyle:Object,overlayClass:o,transitionAppear:Boolean,closeOnClickOverlay:e},H=Object.keys(D);let F=0;const[N,T]=a("popup");let $=2e3;const J=n(c({name:N,inheritAttrs:!1,props:t({},D,{round:Boolean,closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,safeAreaInsetBottom:Boolean,position:{type:String,default:"center"},closeIcon:{type:String,default:"cross"},closeIconPosition:{type:String,default:"top-right"}}),emits:["open","close","click","opened","closed","update:show","click-overlay","click-close-icon"],setup(e,{emit:o,attrs:t,slots:a}){let n,c;const D=p(),H=p(),N=A((()=>e.show||!e.lazyRender)),J=u((()=>{const o={zIndex:D.value};if(s(e.duration)){o["center"===e.position?"animationDuration":"transitionDuration"]=`${e.duration}s`}return o})),M=()=>{n||(void 0!==e.zIndex&&($=+e.zIndex),n=!0,D.value=++$,o("open"))},Q=()=>{n&&k({interceptor:e.beforeClose,done(){n=!1,o("close"),o("update:show",!1)}})},V=t=>{o("click-overlay",t),e.closeOnClickOverlay&&Q()},Y=()=>{if(e.overlay)return v(R,{show:e.show,class:e.overlayClass,zIndex:D.value,duration:e.duration,customStyle:e.overlayStyle,onClick:V},{default:a["overlay-content"]})},q=e=>{o("click-close-icon",e),Q()},G=()=>{if(e.closeable)return v(E,{role:"button",tabindex:0,name:e.closeIcon,class:T("close-icon",e.closeIconPosition),classPrefix:e.iconPrefix,onClick:q},null)},K=e=>o("click",e),U=()=>o("opened"),W=()=>o("closed"),X=N((()=>{var o;const{round:s,position:n,safeAreaInsetBottom:r}=e;return w(v("div",g({ref:H,style:J.value,class:[T({round:s,[n]:n}),{"van-safe-area-bottom":r}],onClick:K},t),[null==(o=a.default)?void 0:o.call(a),G()]),[[x,e.show]])})),Z=()=>{let o;const{position:t,transition:s,transitionAppear:a}=e;return v(y,{name:s||("center"===t?"van-fade":`van-popup-slide-${t}`),appear:a,onAfterEnter:U,onAfterLeave:W},"function"==typeof(n=o=X())||"[object Object]"===Object.prototype.toString.call(n)&&!h(n)?o:{default:()=>[o]});var n};return i((()=>e.show),(e=>{e?M():(n=!1,o("close"))})),I({popupRef:H}),function(e,o){const t=S(),s=o=>{t.move(o);const s=t.deltaY.value>0?"10":"01",a=z(o.target,e.value),{scrollHeight:n,offsetHeight:r,scrollTop:l}=a;let i="11";0===l?i=r>=n?"00":"01":l+r>=n&&(i="10"),"11"===i||!t.isVertical()||parseInt(i,2)&parseInt(s,2)||O(o,!0)},a=()=>{document.addEventListener("touchstart",t.start),document.addEventListener("touchmove",s,!!B&&{passive:!1}),F||document.body.classList.add("van-overflow-hidden"),F++},n=()=>{F&&(document.removeEventListener("touchstart",t.start),document.removeEventListener("touchmove",s),F--,F||document.body.classList.remove("van-overflow-hidden"))},c=()=>o()&&n();P((()=>o()&&a())),r(c),l(c),i(o,(e=>{e?a():n()}))}(H,(()=>e.show&&e.lockScroll)),C("popstate",(()=>{e.closeOnPopstate&&(Q(),c=!1)})),d((()=>{e.show&&M()})),m((()=>{c&&(o("update:show",!0),c=!1)})),r((()=>{e.show&&(Q(),c=!0)})),f(L,(()=>e.show)),()=>e.teleport?v(b,{to:e.teleport},{default:()=>[Y(),Z()]}):v(j,null,[Y(),Z()])}}));export{J as P,H as a,D as p};
