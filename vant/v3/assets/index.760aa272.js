import{n as x,t as k,u as N,p as F,c as G,e as K,m as w,i as M}from"./use-translate.39547e32.js";import{w as V}from"./with-install.cc9696bc.js";import{N as C,O as Y,x as j,z as H,D as S,C as U,G as $,P as Q,L as Z,e as f,T as q,A as J,Q as W,F as X,k as ee,v as oe,I as te}from"./vue-libs.71fdcafc.js";import{c as ne}from"./interceptor.33314343.js";import{u as se}from"./use-expose.877c018b.js";import{u as ae}from"./use-touch.30351383.js";import{o as ce,u as re}from"./index.92de2fdc.js";import{g as le}from"./index.c1e8d10d.js";import{u as ie}from"./use-lazy-render.3dcfda58.js";import{P as ue}from"./on-popup-reopen.d7054786.js";import{I as de}from"./index.5e447543.js";import{O as fe}from"./index.0ff7945f.js";const g={show:Boolean,zIndex:x,overlay:k,duration:x,teleport:[String,Object],lockScroll:k,lazyRender:k,beforeClose:Function,overlayStyle:Object,overlayClass:N,transitionAppear:Boolean,closeOnClickOverlay:k},Le=Object.keys(g);let p=0;const L="van-overflow-hidden";function ve(e,t){const s=ae(),a=r=>{s.move(r);const I=s.deltaY.value>0?"10":"01",h=le(r.target,e.value),{scrollHeight:l,offsetHeight:y,scrollTop:m}=h;let d="11";m===0?d=y>=l?"00":"01":m+y>=l&&(d="10"),d!=="11"&&s.isVertical()&&!(parseInt(d,2)&parseInt(I,2))&&F(r,!0)},n=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",a,{passive:!1}),p||document.body.classList.add(L),p++},c=()=>{p&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",a),p--,p||document.body.classList.remove(L))},v=()=>t()&&n(),u=()=>t()&&c();ce(v),C(u),Y(u),j(t,r=>{r?n():c()})}function me(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!J(e)}const[pe,z]=G("popup");let A=2e3;var he=H({name:pe,inheritAttrs:!1,props:K({},g,{round:Boolean,position:w("center"),closeIcon:w("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:w("top-right"),safeAreaInsetBottom:Boolean}),emits:["open","close","click","opened","closed","update:show","click-overlay","click-close-icon"],setup(e,{emit:t,attrs:s,slots:a}){let n,c;const v=S(),u=S(),r=ie(()=>e.show||!e.lazyRender),I=U(()=>{const o={zIndex:v.value};if(M(e.duration)){const i=e.position==="center"?"animationDuration":"transitionDuration";o[i]=`${e.duration}s`}return o}),h=()=>{n||(e.zIndex!==void 0&&(A=+e.zIndex),n=!0,v.value=++A,t("open"))},l=()=>{n&&ne({interceptor:e.beforeClose,done(){n=!1,t("close"),t("update:show",!1)}})},y=o=>{t("click-overlay",o),e.closeOnClickOverlay&&l()},m=()=>{if(e.overlay)return f(fe,{show:e.show,class:e.overlayClass,zIndex:v.value,duration:e.duration,customStyle:e.overlayStyle,onClick:y},{default:a["overlay-content"]})},d=o=>{t("click-close-icon",o),l()},B=()=>{if(e.closeable)return f(de,{role:"button",tabindex:0,name:e.closeIcon,class:z("close-icon",e.closeIconPosition),classPrefix:e.iconPrefix,onClick:d},null)},E=o=>t("click",o),D=()=>t("opened"),T=()=>t("closed"),_=r(()=>{var P;const{round:o,position:i,safeAreaInsetBottom:O}=e;return ee(f("div",te({ref:u,style:I.value,class:[z({round:o,[i]:i}),{"van-safe-area-bottom":O}],onClick:E},s),[(P=a.default)==null?void 0:P.call(a),B()]),[[oe,e.show]])}),b=()=>{let o;const{position:i,transition:O,transitionAppear:P}=e,R=i==="center"?"van-fade":`van-popup-slide-${i}`;return f(q,{name:O||R,appear:P,onAfterEnter:D,onAfterLeave:T},me(o=_())?o:{default:()=>[o]})};return j(()=>e.show,o=>{o?h():(n=!1,t("close"))}),se({popupRef:u}),ve(u,()=>e.show&&e.lockScroll),re("popstate",()=>{e.closeOnPopstate&&(l(),c=!1)}),$(()=>{e.show&&h()}),Q(()=>{c&&(t("update:show",!0),c=!1)}),C(()=>{e.show&&(l(),c=!0)}),Z(ue,()=>e.show),()=>e.teleport?f(W,{to:e.teleport},{default:()=>[m(),b()]}):f(X,null,[m(),b()])}});const ze=V(he);export{ze as P,Le as a,g as p};
