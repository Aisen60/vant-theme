import{t as e,u as o,p as t,c as s,e as a,i as n}from"./use-translate.91889477.js";import{w as r}from"./with-install.c9eedd0e.js";import{N as l,O as i,x as c,z as d,D as p,C as u,G as m,P as f,L as v,e as y,T as h,A as b,Q as j,F as w,k as x,v as k,I}from"./vue-libs.71fdcafc.js";import{c as g}from"./interceptor.fd551ac3.js";import{u as S}from"./use-expose.5ea79906.js";import{u as O}from"./use-touch.30351383.js";import{o as C,u as P}from"./index.94f7437a.js";import{g as z}from"./index.9e2e36ca.js";import{u as A}from"./use-lazy-render.3dcfda58.js";import{P as B}from"./on-popup-reopen.d7054786.js";import{I as L}from"./index.d38d9435.js";import{O as E}from"./index.38991bce.js";const D={show:Boolean,zIndex:[Number,String],overlay:e,duration:[Number,String],teleport:[String,Object],lockScroll:e,lazyRender:e,beforeClose:Function,overlayStyle:Object,overlayClass:o,transitionAppear:Boolean,closeOnClickOverlay:e},N=Object.keys(D);let R=0;const[F,H]=s("popup");let T=2e3;const $=r(d({name:F,inheritAttrs:!1,props:a({},D,{round:Boolean,closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,safeAreaInsetBottom:Boolean,position:{type:String,default:"center"},closeIcon:{type:String,default:"cross"},closeIconPosition:{type:String,default:"top-right"}}),emits:["open","close","click","opened","closed","update:show","click-overlay","click-close-icon"],setup(e,{emit:o,attrs:s,slots:a}){let r,d;const D=p(),N=p(),F=A((()=>e.show||!e.lazyRender)),$=u((()=>{const o={zIndex:D.value};if(n(e.duration)){o["center"===e.position?"animationDuration":"transitionDuration"]=`${e.duration}s`}return o})),G=()=>{r||(void 0!==e.zIndex&&(T=+e.zIndex),r=!0,D.value=++T,o("open"))},Q=()=>{r&&g({interceptor:e.beforeClose,done(){r=!1,o("close"),o("update:show",!1)}})},V=t=>{o("click-overlay",t),e.closeOnClickOverlay&&Q()},Y=()=>{if(e.overlay)return y(E,{show:e.show,class:e.overlayClass,zIndex:D.value,duration:e.duration,customStyle:e.overlayStyle,onClick:V},{default:a["overlay-content"]})},q=e=>{o("click-close-icon",e),Q()},J=()=>{if(e.closeable)return y(L,{role:"button",tabindex:0,name:e.closeIcon,class:H("close-icon",e.closeIconPosition),classPrefix:e.iconPrefix,onClick:q},null)},K=e=>o("click",e),M=()=>o("opened"),U=()=>o("closed"),W=F((()=>{var o;const{round:t,position:n,safeAreaInsetBottom:r}=e;return x(y("div",I({ref:N,style:$.value,class:[H({round:t,[n]:n}),{"van-safe-area-bottom":r}],onClick:K},s),[null==(o=a.default)?void 0:o.call(a),J()]),[[k,e.show]])})),X=()=>{let o;const{position:t,transition:s,transitionAppear:a}=e;return y(h,{name:s||("center"===t?"van-fade":`van-popup-slide-${t}`),appear:a,onAfterEnter:M,onAfterLeave:U},"function"==typeof(n=o=W())||"[object Object]"===Object.prototype.toString.call(n)&&!b(n)?o:{default:()=>[o]});var n};return c((()=>e.show),(e=>{e?G():(r=!1,o("close"))})),S({popupRef:N}),function(e,o){const s=O(),a=o=>{s.move(o);const a=s.deltaY.value>0?"10":"01",n=z(o.target,e.value),{scrollHeight:r,offsetHeight:l,scrollTop:i}=n;let c="11";0===i?c=l>=r?"00":"01":i+l>=r&&(c="10"),"11"===c||!s.isVertical()||parseInt(c,2)&parseInt(a,2)||t(o,!0)},n=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",a,{passive:!1}),R||document.body.classList.add("van-overflow-hidden"),R++},r=()=>{R&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",a),R--,R||document.body.classList.remove("van-overflow-hidden"))},d=()=>o()&&r();C((()=>o()&&n())),l(d),i(d),c(o,(e=>{e?n():r()}))}(N,(()=>e.show&&e.lockScroll)),P("popstate",(()=>{e.closeOnPopstate&&(Q(),d=!1)})),m((()=>{e.show&&G()})),f((()=>{d&&(o("update:show",!0),d=!1)})),l((()=>{e.show&&(Q(),d=!0)})),v(B,(()=>e.show)),()=>e.teleport?y(j,{to:e.teleport},{default:()=>[Y(),X()]}):y(w,null,[Y(),X()])}}));export{$ as P,N as a,D as p};
