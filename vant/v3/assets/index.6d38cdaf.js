import{c as e,e as t,o as a,K as r,z as u,C as n}from"./use-translate.91889477.js";import{w as l}from"./with-install.c9eedd0e.js";import{u as o}from"./use-expose.5ea79906.js";import{s,t as m,p as i,g as c,a as p}from"./utils.6af751de.js";import{P as v}from"./index.9ab48093.js";import{z as d,D as g,C as f,G as y,q as h,x as D,e as x,I as M}from"./vue-libs.71fdcafc.js";const[H]=e("time-picker");var V=d({name:H,props:t({},s,{modelValue:String,minHour:{type:[Number,String],default:0},maxHour:{type:[Number,String],default:23},minMinute:{type:[Number,String],default:0},maxMinute:{type:[Number,String],default:59}}),emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:t,slots:n}){const l=t=>{const{minHour:a,maxHour:n,maxMinute:l,minMinute:o}=e;t||(t=`${r(a)}:${r(o)}`);let[s,m]=t.split(":");return s=r(u(+s,+a,+n)),m=r(u(+m,+o,+l)),`${s}:${m}`},s=g(),c=g(l(e.modelValue)),p=f((()=>[{type:"hour",range:[+e.minHour,+e.maxHour]},{type:"minute",range:[+e.minMinute,+e.maxMinute]}])),d=f((()=>p.value.map((({type:t,range:a})=>{let u=m(a[1]-a[0]+1,(e=>r(a[0]+e)));return e.filter&&(u=e.filter(t,u)),{type:t,values:u}})))),H=f((()=>d.value.map((t=>({values:t.values.map((a=>e.formatter(t.type,a)))}))))),V=()=>{const t=c.value.split(":"),a=[e.formatter("hour",t[0]),e.formatter("minute",t[1])];h((()=>{var e;null==(e=s.value)||e.setValues(a)}))},$=()=>{const[e,t]=s.value.getIndexes(),[a,r]=d.value,u=a.values[e]||a.values[0],n=r.values[t]||r.values[0];c.value=l(`${u}:${n}`),V()},k=()=>t("confirm",c.value),b=()=>t("cancel"),w=()=>{$(),h((()=>{h((()=>t("change",c.value)))}))};return y((()=>{V(),h($)})),D(H,V),D((()=>[e.filter,e.maxHour,e.minMinute,e.maxMinute]),$),D((()=>e.minHour),(()=>{h($)})),D(c,(e=>t("update:modelValue",e))),D((()=>e.modelValue),(e=>{(e=l(e))!==c.value&&(c.value=e,V())})),o({getPicker:()=>s.value}),()=>x(v,M({ref:s,columns:H.value,onChange:w,onCancel:b,onConfirm:k},a(e,i)),n)}});const $=(new Date).getFullYear(),[k]=e("date-picker");var b=d({name:k,props:t({},s,{modelValue:Date,type:{type:String,default:"datetime"},minDate:{type:Date,default:()=>new Date($-10,0,1),validator:n},maxDate:{type:Date,default:()=>new Date($+10,11,31),validator:n}}),emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:t,slots:l}){const s=t=>{if(n(t)){const a=u(t.getTime(),e.minDate.getTime(),e.maxDate.getTime());return new Date(a)}},d=g(),H=g(s(e.modelValue)),V=(t,a)=>{const r=e[`${t}Date`],u=r.getFullYear();let n=1,l=1,o=0,s=0;return"max"===t&&(n=12,l=c(a.getFullYear(),a.getMonth()+1),o=23,s=59),a.getFullYear()===u&&(n=r.getMonth()+1,a.getMonth()+1===n&&(l=r.getDate(),a.getDate()===l&&(o=r.getHours(),a.getHours()===o&&(s=r.getMinutes())))),{[`${t}Year`]:u,[`${t}Month`]:n,[`${t}Date`]:l,[`${t}Hour`]:o,[`${t}Minute`]:s}},$=f((()=>{const{maxYear:t,maxDate:a,maxMonth:r,maxHour:u,maxMinute:n}=V("max",H.value||e.minDate),{minYear:l,minDate:o,minMonth:s,minHour:m,minMinute:i}=V("min",H.value||e.minDate);let c=[{type:"year",range:[l,t]},{type:"month",range:[s,r]},{type:"day",range:[o,a]},{type:"hour",range:[m,u]},{type:"minute",range:[i,n]}];switch(e.type){case"date":c=c.slice(0,3);break;case"year-month":c=c.slice(0,2);break;case"month-day":c=c.slice(1,3);break;case"datehour":c=c.slice(0,4)}if(e.columnsOrder){const t=e.columnsOrder.concat(c.map((e=>e.type)));c.sort(((e,a)=>t.indexOf(e.type)-t.indexOf(a.type)))}return c})),k=f((()=>$.value.map((({type:t,range:a})=>{let u=m(a[1]-a[0]+1,(e=>r(a[0]+e)));return e.filter&&(u=e.filter(t,u)),{type:t,values:u}})))),b=f((()=>k.value.map((t=>({values:t.values.map((a=>e.formatter(t.type,a)))}))))),w=()=>{const t=H.value||e.minDate,{formatter:a}=e,u=k.value.map((e=>{switch(e.type){case"year":return a("year",`${t.getFullYear()}`);case"month":return a("month",r(t.getMonth()+1));case"day":return a("day",r(t.getDate()));case"hour":return a("hour",r(t.getHours()));case"minute":return a("minute",r(t.getMinutes()));default:return""}}));h((()=>{var e;null==(e=d.value)||e.setValues(u)}))},Y=()=>{const{type:t}=e,a=d.value.getIndexes(),r=e=>{let t=0;k.value.forEach(((a,r)=>{e===a.type&&(t=r)}));const{values:r}=k.value[t];return p(r[a[t]])};let u,n,l;"month-day"===t?(u=(H.value||e.minDate).getFullYear(),n=r("month"),l=r("day")):(u=r("year"),n=r("month"),l="year-month"===t?1:r("day"));const o=c(u,n);l=l>o?o:l;let m=0,i=0;"datehour"===t&&(m=r("hour")),"datetime"===t&&(m=r("hour"),i=r("minute"));const v=new Date(u,n-1,l,m,i);H.value=s(v)},j=()=>{t("update:modelValue",H.value),t("confirm",H.value)},C=()=>t("cancel"),O=()=>{Y(),h((()=>{h((()=>t("change",H.value)))}))};return y((()=>{w(),h(Y)})),D(b,w),D(H,((e,a)=>t("update:modelValue",a?e:null))),D((()=>[e.filter,e.maxDate]),Y),D((()=>e.minDate),(()=>{h(Y)})),D((()=>e.modelValue),(e=>{var t;(e=s(e))&&e.valueOf()!==(null==(t=H.value)?void 0:t.valueOf())&&(H.value=e)})),o({getPicker:()=>d.value}),()=>x(v,M({ref:d,columns:b.value,onChange:O,onCancel:C,onConfirm:j},a(e,i)),l)}});const[w,Y]=e("datetime-picker"),j=Object.keys(V.props),C=Object.keys(b.props);const O=l(d({name:w,props:t({},V.props,b.props,{modelValue:[String,Date]}),setup(e,{attrs:t,slots:r}){const u=g();return o({getPicker:()=>{var e;return null==(e=u.value)?void 0:e.getPicker()}}),()=>{const n="time"===e.type,l=n?V:b,o=a(e,n?j:C);return x(l,M({ref:u,class:Y()},o,t),r)}}}));export{O as D};
