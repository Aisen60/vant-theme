import{c as e,p as o,z as t,o as a,t as s,u as i,b as n,e as r}from"./use-translate.91889477.js";import{w as l}from"./with-install.c9eedd0e.js";import{m as c,u as m}from"./mount-component.d3f8f39a.js";import{c as u}from"./interceptor.fd551ac3.js";import{u as v}from"./use-expose.5ea79906.js";import{I as d}from"./index.d38d9435.js";import{a as g,u as p,S as h}from"./index.0a6905cd.js";import{P as f}from"./index.b58615a3.js";import{u as w}from"./use-touch.30351383.js";import{I as y}from"./index.9ee79ebb.js";import{L as b}from"./index.6e9dbec3.js";import{z as x,E as S,C as I,x as j,e as C,D as X,G as z,q as P,A as Y,I as N}from"./vue-libs.71fdcafc.js";const Z=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),H=e("image-preview")[1];var W=x({props:{src:String,show:Boolean,active:Number,minZoom:{type:[Number,String],required:!0},maxZoom:{type:[Number,String],required:!0},rootWidth:{type:Number,required:!0},rootHeight:{type:Number,required:!0}},emits:["scale","close"],setup(e,{emit:a}){const s=S({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),i=w(),n=I((()=>{const{rootWidth:o,rootHeight:t}=e,a=t/o;return s.imageRatio>a})),r=I((()=>{const{scale:e,moveX:o,moveY:t,moving:a,zooming:i}=s,n={transitionDuration:i||a?"0s":".3s"};if(1!==e){const a=o/e,s=t/e;n.transform=`scale(${e}, ${e}) translate(${a}px, ${s}px)`}return n})),l=I((()=>{if(s.imageRatio){const{rootWidth:o,rootHeight:t}=e,a=n.value?t/s.imageRatio:o;return Math.max(0,(s.scale*a-o)/2)}return 0})),c=I((()=>{if(s.imageRatio){const{rootWidth:o,rootHeight:t}=e,a=n.value?t:o*s.imageRatio;return Math.max(0,(s.scale*a-t)/2)}return 0})),m=o=>{(o=t(o,+e.minZoom,+e.maxZoom))!==s.scale&&(s.scale=o,a("scale",{scale:o,index:e.active}))},u=()=>{m(1),s.moveX=0,s.moveY=0};let v,d,p,h,f,x;const X=e=>{const{touches:o}=e,{offsetX:t}=i;i.start(e),v=s.moveX,d=s.moveY,x=Date.now(),s.moving=1===o.length&&1!==s.scale,s.zooming=2===o.length&&!t.value,s.zooming&&(p=s.scale,h=Z(e.touches))},z=e=>{const{touches:a}=e;if(i.move(e),(s.moving||s.zooming)&&o(e,!0),s.moving){const{deltaX:e,deltaY:o}=i,a=e.value+v,n=o.value+d;s.moveX=t(a,-l.value,l.value),s.moveY=t(n,-c.value,c.value)}if(s.zooming&&2===a.length){const e=Z(a);m(p*e/h)}},P=()=>{const{offsetX:e,offsetY:o}=i,t=Date.now()-x;e.value<10&&o.value<10&&t<250&&(f?(clearTimeout(f),f=null,(()=>{const e=s.scale>1?1:2;m(e),s.moveX=0,s.moveY=0})()):f=setTimeout((()=>{a("close"),f=null}),250))},Y=e=>{let a=!1;(s.moving||s.zooming)&&(a=!0,s.moving&&v===s.moveX&&d===s.moveY&&(a=!1),e.touches.length||(s.zooming&&(s.moveX=t(s.moveX,-l.value,l.value),s.moveY=t(s.moveY,-c.value,c.value),s.zooming=!1),s.moving=!1,v=0,d=0,p=1,s.scale<1&&u())),o(e,a),P(),i.reset()},N=e=>{const{naturalWidth:o,naturalHeight:t}=e.target;s.imageRatio=t/o};return j((()=>e.active),u),j((()=>e.show),(e=>{e||u()})),()=>{const o={loading:()=>C(b,{type:"spinner"},null)};return C(g,{class:H("swipe-item"),onTouchstart:X,onTouchmove:z,onTouchend:Y,onTouchcancel:Y},{default:()=>[C(y,{src:e.src,fit:"contain",class:H("image",{vertical:n.value}),style:r.value,onLoad:N},o)]})}}});const[R,T]=e("image-preview");var D=x({name:R,props:{show:Boolean,loop:s,overlay:s,closeable:Boolean,showIndex:s,className:i,transition:String,beforeClose:Function,overlayStyle:Object,showIndicators:Boolean,closeOnPopstate:s,images:{type:Array,default:()=>[]},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},closeIcon:{type:String,default:"clear"},closeIconPosition:{type:String,default:"top-right"}},emits:["scale","close","closed","change","update:show"],setup(e,{emit:o,slots:t}){const s=X(),i=p(),n=S({active:0,rootWidth:0,rootHeight:0}),r=()=>{if(s.value){const e=s.value.$el.getBoundingClientRect();n.rootWidth=e.width,n.rootHeight=e.height,s.value.resize()}},l=e=>o("scale",e),c=e=>o("update:show",e),m=()=>{u({interceptor:e.beforeClose,args:[n.active],done:()=>c(!1)})},g=e=>{e!==n.active&&(n.active=e,o("change",e))},w=()=>{if(e.showIndex)return C("div",{class:T("index")},[t.index?t.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},y=()=>{if(t.cover)return C("div",{class:T("cover")},[t.cover()])},b=()=>{let o;return C(h,{ref:s,lazyRender:!0,loop:e.loop,class:T("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:g},"function"==typeof(t=o=e.images.map((o=>C(W,{src:o,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,onScale:l,onClose:m},null))))||"[object Object]"===Object.prototype.toString.call(t)&&!Y(t)?o:{default:()=>[o]});var t},x=()=>{if(e.closeable)return C(d,{role:"button",name:e.closeIcon,class:T("close-icon",e.closeIconPosition),onClick:m},null)},I=()=>o("closed"),Z=(e,o)=>{var t;return null==(t=s.value)?void 0:t.swipeTo(e,o)};return v({swipeTo:Z}),z(r),j([i.width,i.height],r),j((()=>e.startPosition),(e=>g(+e))),j((()=>e.show),(t=>{const{images:a,startPosition:s}=e;t?(g(+s),P((()=>{r(),Z(+s,{immediate:!0})}))):o("close",{index:n.active,url:a[n.active]})})),()=>C(f,N({class:[T(),e.className],overlayClass:T("overlay"),onClosed:I},a(e,["show","transition","overlayStyle","closeOnPopstate"]),{"onUpdate:show":c}),{default:()=>[x(),b(),w(),y()]})}});let $;const q={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};const O=(e,o=0)=>{if(n)return $||({instance:$}=c({setup(){const{state:e,toggle:o}=m(),t=()=>{e.images=[]};return()=>C(D,N(e,{onClosed:t,"onUpdate:show":o}),null)}})),e=Array.isArray(e)?{images:e,startPosition:o}:e,$.open(r({},q,e)),$};O.Component=l(D),O.install=e=>{e.use(O.Component)};export{O as I};
