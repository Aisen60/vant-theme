import{e,p as t,q as a,o as r}from"./use-translate.bf1abf23.js";import{c as n,w as u}from"./with-install.af140ae3.js";import{u as l}from"./use-expose.028ef04d.js";import{c as o}from"./number.b01aa591.js";import{s,p as m,t as i,a as p,g as c}from"./utils.6a79078e.js";import{P as v}from"./index.5c6c3b01.js";import{B as d,G as g,E as f,I as y,s as h,z as D,f as x,L as M}from"./vendor.09b5b9a9.js";const[b]=n("time-picker");var H=d({name:b,props:e({},s,{modelValue:String,minHour:{type:[Number,String],default:0},maxHour:{type:[Number,String],default:23},minMinute:{type:[Number,String],default:0},maxMinute:{type:[Number,String],default:59}}),emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:r,slots:n}){const u=t=>{const{minHour:r,maxHour:n,maxMinute:u,minMinute:l}=e;t||(t=`${a(r)}:${a(l)}`);let[s,m]=t.split(":");return s=a(o(+s,+r,+n)),m=a(o(+m,+l,+u)),`${s}:${m}`},s=g(),p=g(u(e.modelValue)),c=f((()=>[{type:"hour",range:[+e.minHour,+e.maxHour]},{type:"minute",range:[+e.minMinute,+e.maxMinute]}])),d=f((()=>c.value.map((({type:t,range:r})=>{let n=i(r[1]-r[0]+1,(e=>a(r[0]+e)));return e.filter&&(n=e.filter(t,n)),{type:t,values:n}})))),b=f((()=>d.value.map((t=>({values:t.values.map((a=>e.formatter(t.type,a)))}))))),H=()=>{const t=p.value.split(":"),a=[e.formatter("hour",t[0]),e.formatter("minute",t[1])];h((()=>{var e;null==(e=s.value)||e.setValues(a)}))},V=()=>{const[e,t]=s.value.getIndexes(),[a,r]=d.value,n=a.values[e]||a.values[0],l=r.values[t]||r.values[0];p.value=u(`${n}:${l}`),H()},$=()=>r("confirm",p.value),k=()=>r("cancel"),j=()=>{V(),h((()=>{h((()=>r("change",p.value)))}))};return y((()=>{H(),h(V)})),D(b,H),D((()=>[e.filter,e.maxHour,e.minMinute,e.maxMinute]),V),D((()=>e.minHour),(()=>{h(V)})),D(p,(e=>r("update:modelValue",e))),D((()=>e.modelValue),(e=>{(e=u(e))!==p.value&&(p.value=e,H())})),l({getPicker:()=>s.value}),()=>x(v,M({ref:s,columns:b.value,onChange:j,onCancel:k,onConfirm:$},t(e,m)),n)}});const V=(new Date).getFullYear(),[$]=n("date-picker");var k=d({name:$,props:e({},s,{modelValue:Date,type:{type:String,default:"datetime"},minDate:{type:Date,default:()=>new Date(V-10,0,1),validator:r},maxDate:{type:Date,default:()=>new Date(V+10,11,31),validator:r}}),emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:n,slots:u}){const s=t=>{if(r(t)){const a=o(t.getTime(),e.minDate.getTime(),e.maxDate.getTime());return new Date(a)}},d=g(),b=g(s(e.modelValue)),H=(t,a)=>{const r=e[`${t}Date`],n=r.getFullYear();let u=1,l=1,o=0,s=0;return"max"===t&&(u=12,l=c(a.getFullYear(),a.getMonth()+1),o=23,s=59),a.getFullYear()===n&&(u=r.getMonth()+1,a.getMonth()+1===u&&(l=r.getDate(),a.getDate()===l&&(o=r.getHours(),a.getHours()===o&&(s=r.getMinutes())))),{[`${t}Year`]:n,[`${t}Month`]:u,[`${t}Date`]:l,[`${t}Hour`]:o,[`${t}Minute`]:s}},V=f((()=>{const{maxYear:t,maxDate:a,maxMonth:r,maxHour:n,maxMinute:u}=H("max",b.value||e.minDate),{minYear:l,minDate:o,minMonth:s,minHour:m,minMinute:i}=H("min",b.value||e.minDate);let p=[{type:"year",range:[l,t]},{type:"month",range:[s,r]},{type:"day",range:[o,a]},{type:"hour",range:[m,n]},{type:"minute",range:[i,u]}];switch(e.type){case"date":p=p.slice(0,3);break;case"year-month":p=p.slice(0,2);break;case"month-day":p=p.slice(1,3);break;case"datehour":p=p.slice(0,4)}if(e.columnsOrder){const t=e.columnsOrder.concat(p.map((e=>e.type)));p.sort(((e,a)=>t.indexOf(e.type)-t.indexOf(a.type)))}return p})),$=f((()=>V.value.map((({type:t,range:r})=>{let n=i(r[1]-r[0]+1,(e=>a(r[0]+e)));return e.filter&&(n=e.filter(t,n)),{type:t,values:n}})))),k=f((()=>$.value.map((t=>({values:t.values.map((a=>e.formatter(t.type,a)))}))))),j=()=>{const t=b.value||e.minDate,{formatter:r}=e,n=$.value.map((e=>{switch(e.type){case"year":return r("year",`${t.getFullYear()}`);case"month":return r("month",a(t.getMonth()+1));case"day":return r("day",a(t.getDate()));case"hour":return r("hour",a(t.getHours()));case"minute":return r("minute",a(t.getMinutes()));default:return""}}));h((()=>{var e;null==(e=d.value)||e.setValues(n)}))},w=()=>{const{type:t}=e,a=d.value.getIndexes(),r=e=>{let t=0;$.value.forEach(((a,r)=>{e===a.type&&(t=r)}));const{values:r}=$.value[t];return p(r[a[t]])};let n,u,l;"month-day"===t?(n=(b.value||e.minDate).getFullYear(),u=r("month"),l=r("day")):(n=r("year"),u=r("month"),l="year-month"===t?1:r("day"));const o=c(n,u);l=l>o?o:l;let m=0,i=0;"datehour"===t&&(m=r("hour")),"datetime"===t&&(m=r("hour"),i=r("minute"));const v=new Date(n,u-1,l,m,i);b.value=s(v)},Y=()=>{n("update:modelValue",b.value),n("confirm",b.value)},O=()=>n("cancel"),S=()=>{w(),h((()=>{h((()=>n("change",b.value)))}))};return y((()=>{j(),h(w)})),D(k,j),D(b,((e,t)=>n("update:modelValue",t?e:null))),D((()=>[e.filter,e.maxDate]),w),D((()=>e.minDate),(()=>{h(w)})),D((()=>e.modelValue),(e=>{var t;(e=s(e))&&e.valueOf()!==(null==(t=b.value)?void 0:t.valueOf())&&(b.value=e)})),l({getPicker:()=>d.value}),()=>x(v,M({ref:d,columns:k.value,onChange:S,onCancel:O,onConfirm:Y},t(e,m)),u)}});const[j,w]=n("datetime-picker"),Y=Object.keys(H.props),O=Object.keys(k.props);const S=u(d({name:j,props:e({},H.props,k.props,{modelValue:[String,Date]}),setup(e,{attrs:a,slots:r}){const n=g();return l({getPicker:()=>{var e;return null==(e=n.value)?void 0:e.getPicker()}}),()=>{const u="time"===e.type,l=u?H:k,o=t(e,u?Y:O);return x(l,M({ref:n,class:w()},o,a),r)}}}));export{S as D};
