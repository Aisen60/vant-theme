import{t as e}from"./use-translate.bf1abf23.js";import{c as t,w as a}from"./with-install.af140ae3.js";import{i}from"./style.ae88e9b6.js";import{p as l}from"./event.7d40caae.js";import{c as o}from"./number.b01aa591.js";import{u as s}from"./use-touch.871001cd.js";import{u as r}from"./use-expose.028ef04d.js";import{o as n}from"./on-popup-reopen.d2d6f1c6.js";import{i as u,d as v}from"./utils.fd06bcd3.js";import{u as c}from"./index.2baefb73.js";import{G as f,B as p,H as h,E as d,z as m,I as g,R as w,P as b,Q as y,f as j,s as S}from"./vendor.09b5b9a9.js";import{u as x}from"./useChildren.692bc2bf.js";import{u as C}from"./useParent.60a302fe.js";function z(){var e=f(u?window.innerWidth:0),t=f(u?window.innerHeight:0),a=()=>{e.value=window.innerWidth,t.value=window.innerHeight};return c("resize",a),c("orientationchange",a),{width:e,height:t}}const[$,M]=t("swipe"),T={loop:e,width:[Number,String],height:[Number,String],vertical:Boolean,touchable:e,lazyRender:Boolean,indicatorColor:String,showIndicators:e,stopPropagation:e,autoplay:{type:[Number,String],default:0},duration:{type:[Number,String],default:500},initialSwipe:{type:[Number,String],default:0}},I=Symbol($);const N=a(p({name:$,props:T,emits:["change"],setup(e,{emit:t,slots:a}){const p=f(),S=h({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),C=s(),$=z(),{children:T,linkChildren:N}=x(I),H=d((()=>T.length)),O=d((()=>S[e.vertical?"height":"width"])),P=d((()=>e.vertical?C.deltaY.value:C.deltaX.value)),X=d((()=>{if(S.rect){return(e.vertical?S.rect.height:S.rect.width)-O.value*H.value}return 0})),Y=d((()=>Math.ceil(Math.abs(X.value)/O.value))),k=d((()=>H.value*O.value)),B=d((()=>(S.active+H.value)%H.value)),D=d((()=>{const t=e.vertical?"vertical":"horizontal";return C.direction.value===t})),R=d((()=>{const t={transitionDuration:`${S.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${S.offset}px)`};if(O.value){const a=e.vertical?"height":"width",i=e.vertical?"width":"height";t[a]=`${k.value}px`,t[i]=e[i]?`${e[i]}px`:""}return t})),W=(t,a=0)=>{let i=t*O.value;e.loop||(i=Math.min(i,-X.value));let l=a-i;return e.loop||(l=o(l,X.value,0)),l},E=({pace:a=0,offset:i=0,emitChange:l})=>{if(H.value<=1)return;const{active:s}=S,r=(t=>{const{active:a}=S;return t?e.loop?o(a+t,-1,H.value):o(a+t,0,Y.value):a})(a),n=W(r,i);if(e.loop){if(T[0]&&n!==X.value){const e=n<X.value;T[0].setOffset(e?k.value:0)}if(T[H.value-1]&&0!==n){const e=n>0;T[H.value-1].setOffset(e?-k.value:0)}}S.active=r,S.offset=n,l&&r!==s&&t("change",B.value)},A=()=>{S.swiping=!0,S.active<=-1?E({pace:H.value}):S.active>=H.value&&E({pace:-H.value})},G=()=>{A(),C.reset(),v((()=>{S.swiping=!1,E({pace:1,emitChange:!0})}))};let Q;const q=()=>clearTimeout(Q),F=()=>{q(),e.autoplay>0&&H.value>1&&(Q=setTimeout((()=>{G(),F()}),+e.autoplay))},J=(t=+e.initialSwipe)=>{var a,l;if(p.value){if(!i(p)){const t={width:p.value.offsetWidth,height:p.value.offsetHeight};S.rect=t,S.width=+(null!=(a=e.width)?a:t.width),S.height=+(null!=(l=e.height)?l:t.height)}H.value&&(t=Math.min(H.value-1,t)),S.active=t,S.swiping=!0,S.offset=W(t),T.forEach((e=>{e.setOffset(0)}))}},K=()=>J(S.active);let L;const U=t=>{e.touchable&&(C.start(t),L=Date.now(),q(),A())},V=t=>{e.touchable&&S.swiping&&(C.move(t),D.value&&(l(t,e.stopPropagation),E({offset:P.value})))},Z=()=>{if(!e.touchable||!S.swiping)return;const t=Date.now()-L,a=P.value/t;if((Math.abs(a)>.25||Math.abs(P.value)>O.value/2)&&D.value){const t=e.vertical?C.offsetY.value:C.offsetX.value;let a=0;a=e.loop?t>0?P.value>0?-1:1:0:-Math[P.value>0?"ceil":"floor"](P.value/O.value),E({pace:a,emitChange:!0})}else P.value&&E({pace:0});S.swiping=!1,F()},_=(t,a)=>{const i=a===B.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return j("i",{style:l,class:M("indicator",{active:i})},null)};var ee,te;return r({prev:()=>{A(),C.reset(),v((()=>{S.swiping=!1,E({pace:-1,emitChange:!0})}))},next:G,state:S,resize:K,swipeTo:(t,a={})=>{A(),C.reset(),v((()=>{let i;i=e.loop&&t===H.value?0===S.active?0:t:t%H.value,a.immediate?v((()=>{S.swiping=!1})):S.swiping=!1,E({pace:i-S.active,emitChange:!0})}))}}),N({size:O,props:e,count:H,activeIndicator:B}),m((()=>e.initialSwipe),(e=>J(+e))),m(H,(()=>J(S.active))),m([H,()=>e.autoplay],F),m([$.width,$.height],K),m((ee=f("visible"),(te=()=>{u&&(ee.value=document.hidden?"hidden":"visible")})(),c("visibilitychange",te),ee),(e=>{"visible"===e?F():q()})),g(J),w((()=>J(S.active))),n((()=>J(S.active))),b(q),y(q),()=>{var t;return j("div",{ref:p,class:M()},[j("div",{style:R.value,class:M("track",{vertical:e.vertical}),onTouchstart:U,onTouchmove:V,onTouchend:Z,onTouchcancel:Z},[null==(t=a.default)?void 0:t.call(a)]),a.indicator?a.indicator({active:B.value}):e.showIndicators&&H.value>1?j("div",{class:M("indicators",{vertical:e.vertical})},[Array(H.value).fill("").map(_)]):void 0])}}})),[H,O]=t("swipe-item");const P=a(p({name:H,setup(e,{slots:t}){let a;const i=h({offset:0,inited:!1,mounted:!1}),{parent:l,index:o}=C(I);if(!l)return;const s=d((()=>{const e={},{vertical:t}=l.props;return l.size.value&&(e[t?"height":"width"]=`${l.size.value}px`),i.offset&&(e.transform=`translate${t?"Y":"X"}(${i.offset}px)`),e})),n=d((()=>{const{loop:e,lazyRender:t}=l.props;if(!t||a)return!0;if(!i.mounted)return!1;const s=l.activeIndicator.value,r=l.count.value-1,n=0===s&&e?r:s-1,u=s===r&&e?0:s+1;return a=o.value===s||o.value===n||o.value===u,a}));return g((()=>{S((()=>{i.mounted=!0}))})),r({setOffset:e=>{i.offset=e}}),()=>{var e;return j("div",{class:O(),style:s.value},[n.value?null==(e=t.default)?void 0:e.call(t):null])}}}));export{N as S,P as a,z as u};
