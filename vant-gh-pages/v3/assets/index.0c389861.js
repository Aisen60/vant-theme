import"./use-translate.bf1abf23.js";import{c as t,b as e,w as s}from"./with-install.af140ae3.js";import{p as a}from"./event.7d40caae.js";import{u as n}from"./use-touch.871001cd.js";import{L as o}from"./index.4893bdc2.js";import{B as i,G as u,H as r,z as l,f as c,C as d,s as m}from"./vendor.09b5b9a9.js";import{u as p}from"./index.e4b17f1e.js";const[g,h,f]=t("pull-refresh"),b=["pulling","loosing","success"];const v=s(i({name:g,props:{disabled:Boolean,successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:[Number,String],modelValue:{type:Boolean,default:!1},successDuration:{type:[Number,String],default:500},animationDuration:{type:[Number,String],default:300},headHeight:{type:[Number,String],default:50}},emits:["refresh","update:modelValue"],setup(t,{emit:s,slots:i}){let g;const v=u(),x=p(v),T=r({status:"normal",distance:0,duration:0}),j=n(),D=()=>{if(50!==t.headHeight)return{height:`${t.headHeight}px`}},S=()=>"loading"!==T.status&&"success"!==T.status&&!t.disabled,y=(e,s)=>{const a=+(t.pullDistance||t.headHeight);T.distance=e,T.status=s?"loading":0===e?"normal":e<a?"pulling":"loosing"},H=()=>{const{status:e}=T;return"normal"===e?"":t[`${e}Text`]||f(e)},V=()=>{const{status:t,distance:e}=T;if(i[t])return i[t]({distance:e});const s=[];if(b.includes(t)&&s.push(c("div",{class:h("text")},[H()])),"loading"===t){let t;s.push(c(o,{class:h("loading")},"function"==typeof(a=t=H())||"[object Object]"===Object.prototype.toString.call(a)&&!d(a)?t:{default:()=>[t]}))}var a;return s},N=t=>{g=0===e(x.value),g&&(T.duration=0,j.start(t))},$=t=>{S()&&N(t)},B=e=>{if(S()){g||N(e);const{deltaY:s}=j;j.move(e),g&&s.value>=0&&j.isVertical()&&(a(e),y((e=>{const s=+(t.pullDistance||t.headHeight);return e>s&&(e=e<2*s?s+(e-s)/2:1.5*s+(e-2*s)/4),Math.round(e)})(s.value)))}},w=()=>{g&&j.deltaY.value&&S()&&(T.duration=+t.animationDuration,"loosing"===T.status?(y(+t.headHeight,!0),s("update:modelValue",!0),m((()=>s("refresh")))):y(0))};return l((()=>t.modelValue),(e=>{T.duration=+t.animationDuration,e?y(+t.headHeight,!0):i.success||t.successText?(T.status="success",setTimeout((()=>{y(0)}),+t.successDuration)):y(0,!1)})),()=>{var t;const e={transitionDuration:`${T.duration}ms`,transform:T.distance?`translate3d(0,${T.distance}px, 0)`:""};return c("div",{ref:v,class:h()},[c("div",{class:h("track"),style:e,onTouchstart:$,onTouchmove:B,onTouchend:w,onTouchcancel:w},[c("div",{class:h("head"),style:D()},[V()]),null==(t=i.default)?void 0:t.call(i)])])}}}));export{v as P};
