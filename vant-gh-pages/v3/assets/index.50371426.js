import{s as t,Y as e,B as i,r,W as s,a as n,f as o,w as a,D as h,F as d,o as l,b as c,l as u,e as p}from"./vendor.09b5b9a9.js";import{a as g}from"./use-translate.bf1abf23.js";var v="undefined"!=typeof window&&null!==window;var m=!!(v&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)&&("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0),f="event",b="observer",y=function(){if(v)return"function"==typeof window.CustomEvent?window.CustomEvent:(t.prototype=window.Event.prototype,t);function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}}();function w(t,e){if(t.length){var i=t.indexOf(e);return i>-1?t.splice(i,1):void 0}}function L(t,e){if("IMG"===t.tagName&&t.getAttribute("data-srcset")){var i,r,s,n=t.getAttribute("data-srcset"),o=t.parentNode.offsetWidth*e,a=(n=n.trim().split(",")).map((t=>(t=t.trim(),-1===(i=t.lastIndexOf(" "))?(r=t,s=999998):(r=t.substr(0,i),s=parseInt(t.substr(i+1,t.length-i-2),10)),[s,r])));a.sort((function(t,e){if(t[0]<e[0])return 1;if(t[0]>e[0])return-1;if(t[0]===e[0]){if(-1!==e[1].indexOf(".webp",e[1].length-5))return 1;if(-1!==t[1].indexOf(".webp",t[1].length-5))return-1}return 0}));for(var h,d="",l=0;l<a.length;l++){d=(h=a[l])[1];var c=a[l+1];if(c&&c[0]<o){d=h[1];break}if(!c){d=h[1];break}}return d}}function _(t,e){for(var i,r=0,s=t.length;r<s;r++)if(e(t[r])){i=t[r];break}return i}var E=(t=1)=>v&&window.devicePixelRatio||t;function z(){if(!v)return!1;var t=!0;try{var e=document.createElement("canvas");e.getContext&&e.getContext("2d")&&(t=0===e.toDataURL("image/webp").indexOf("data:image/webp"))}catch(i){t=!1}return t}var A=function(){if(v){var t=!1;try{var e=Object.defineProperty({},"passive",{get(){t=!0}});window.addEventListener("test",null,e)}catch(i){}return t}}(),$={on(t,e,i,r=!1){A?t.addEventListener(e,i,{capture:r,passive:!0}):t.addEventListener(e,i,r)},off(t,e,i,r=!1){t.removeEventListener(e,i,r)}},I=(t,e,i)=>{var r=new Image;if(!t||!t.src){var s=new Error("image src is required");return i(s)}r.src=t.src,t.cors&&(r.crossOrigin=t.cors),r.onload=function(){e({naturalHeight:r.naturalHeight,naturalWidth:r.naturalWidth,src:r.src})},r.onerror=function(t){i(t)}},C=(t,e)=>"undefined"!=typeof getComputedStyle?getComputedStyle(t,null).getPropertyValue(e):t.style[e],T=t=>C(t,"overflow")+C(t,"overflow-y")+C(t,"overflow-x");function O(){}class x{constructor({max:t}){this.options={max:t||100},this._caches=[]}has(t){return this._caches.indexOf(t)>-1}add(t){this.has(t)||(this._caches.push(t),this._caches.length>this.options.max&&this.free())}free(){this._caches.shift()}}class H{constructor({el:t,src:e,error:i,loading:r,bindType:s,$parent:n,options:o,cors:a,elRenderer:h,imageCache:d}){this.el=t,this.src=e,this.error=i,this.loading=r,this.bindType=s,this.attempt=0,this.cors=a,this.naturalHeight=0,this.naturalWidth=0,this.options=o,this.rect=null,this.$parent=n,this.elRenderer=h,this._imageCache=d,this.performanceData={init:Date.now(),loadStart:0,loadEnd:0},this.filter(),this.initState(),this.render("loading",!1)}initState(){"dataset"in this.el?this.el.dataset.src=this.src:this.el.setAttribute("data-src",this.src),this.state={loading:!1,error:!1,loaded:!1,rendered:!1}}record(t){this.performanceData[t]=Date.now()}update({src:t,loading:e,error:i}){var r=this.src;this.src=t,this.loading=e,this.error=i,this.filter(),r!==this.src&&(this.attempt=0,this.initState())}getRect(){this.rect=this.el.getBoundingClientRect()}checkInView(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}filter(){Object.keys(this.options.filter).forEach((t=>{this.options.filter[t](this,this.options)}))}renderLoading(t){this.state.loading=!0,I({src:this.loading,cors:this.cors},(()=>{this.render("loading",!1),this.state.loading=!1,t()}),(()=>{t(),this.state.loading=!1,this.options.silent||console.warn("VueLazyload log: load failed with loading image("+this.loading+")")}))}load(t=O){return this.attempt>this.options.attempt-1&&this.state.error?(this.options.silent||console.log("VueLazyload log: "+this.src+" tried too more than "+this.options.attempt+" times"),void t()):this.state.rendered&&this.state.loaded?void 0:this._imageCache.has(this.src)?(this.state.loaded=!0,this.render("loaded",!0),this.state.rendered=!0,t()):void this.renderLoading((()=>{var e,i;this.attempt++,null==(e=(i=this.options.adapter).beforeLoad)||e.call(i,this,this.options),this.record("loadStart"),I({src:this.src,cors:this.cors},(e=>{this.naturalHeight=e.naturalHeight,this.naturalWidth=e.naturalWidth,this.state.loaded=!0,this.state.error=!1,this.record("loadEnd"),this.render("loaded",!1),this.state.rendered=!0,this._imageCache.add(this.src),t()}),(t=>{!this.options.silent&&console.error(t),this.state.error=!0,this.state.loaded=!1,this.render("error",!1)}))}))}render(t,e){this.elRenderer(this,t,e)}performance(){var t="loading",e=0;return this.state.loaded&&(t="loaded",e=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(t="error"),{src:this.src,state:t,time:e}}$destroy(){this.el=null,this.src=null,this.error=null,this.loading=null,this.bindType=null,this.attempt=0}}var Q="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",R=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],j={rootMargin:"0px",threshold:0};function S(){return class{constructor({preLoad:t,error:e,throttleWait:i,preLoadTop:r,dispatchEvent:s,loading:n,attempt:o,silent:a=!0,scale:h,listenEvents:d,filter:l,adapter:c,observer:u,observerOptions:p}){var g,v,m,y;this.mode=f,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:a,dispatchEvent:!!s,throttleWait:i||200,preLoad:t||1.3,preLoadTop:r||0,error:e||Q,loading:n||Q,attempt:o||3,scale:h||E(h),ListenEvents:d||R,hasbind:!1,supportWebp:z(),filter:l||{},adapter:c||{},observer:!!u,observerOptions:p||j},this._initEvent(),this._imageCache=new x({max:200}),this.lazyLoadHandler=(g=this._lazyLoadHandler.bind(this),v=this.options.throttleWait,m=null,y=0,function(...t){if(!m){var e=()=>{y=Date.now(),m=!1,g.apply(this,t)};Date.now()-y>=v?e():m=setTimeout(e,v)}}),this.setMode(this.options.observer?b:f)}config(t={}){Object.assign(this.options,t)}performance(){return this.ListenerQueue.map((t=>t.performance()))}addLazyBox(t){this.ListenerQueue.push(t),v&&(this._addListenerTarget(window),this._observer&&this._observer.observe(t.el),t.$el&&t.$el.parentNode&&this._addListenerTarget(t.$el.parentNode))}add(e,i,r){if(this.ListenerQueue.some((t=>t.el===e)))return this.update(e,i),t(this.lazyLoadHandler);var s=this._valueFormatter(i.value),{src:n}=s;t((()=>{n=L(e,this.options.scale)||n,this._observer&&this._observer.observe(e);var o,a=Object.keys(i.modifiers)[0];a&&(o=(o=r.context.$refs[a])?o.$el||o:document.getElementById(a)),o||(o=(t=>{if(v){if(!(t instanceof HTMLElement))return window;for(var e=t;e&&e!==document.body&&e!==document.documentElement&&e.parentNode;){if(/(scroll|auto)/.test(T(e)))return e;e=e.parentNode}return window}})(e));var h=new H({bindType:i.arg,$parent:o,el:e,src:n,loading:s.loading,error:s.error,cors:s.cors,elRenderer:this._elRenderer.bind(this),options:this.options,imageCache:this._imageCache});this.ListenerQueue.push(h),v&&(this._addListenerTarget(window),this._addListenerTarget(o)),this.lazyLoadHandler(),t((()=>this.lazyLoadHandler()))}))}update(e,i,r){var s=this._valueFormatter(i.value),{src:n}=s;n=L(e,this.options.scale)||n;var o=_(this.ListenerQueue,(t=>t.el===e));o?o.update({src:n,error:s.error,loading:s.loading}):this.add(e,i,r),this._observer&&(this._observer.unobserve(e),this._observer.observe(e)),this.lazyLoadHandler(),t((()=>this.lazyLoadHandler()))}remove(t){if(t){this._observer&&this._observer.unobserve(t);var e=_(this.ListenerQueue,(e=>e.el===t));e&&(this._removeListenerTarget(e.$parent),this._removeListenerTarget(window),w(this.ListenerQueue,e),e.$destroy())}}removeComponent(t){t&&(w(this.ListenerQueue,t),this._observer&&this._observer.unobserve(t.el),t.$parent&&t.$el.parentNode&&this._removeListenerTarget(t.$el.parentNode),this._removeListenerTarget(window))}setMode(t){m||t!==b||(t=f),this.mode=t,t===f?(this._observer&&(this.ListenerQueue.forEach((t=>{this._observer.unobserve(t.el)})),this._observer=null),this.TargetQueue.forEach((t=>{this._initListen(t.el,!0)}))):(this.TargetQueue.forEach((t=>{this._initListen(t.el,!1)})),this._initIntersectionObserver())}_addListenerTarget(t){if(t){var e=_(this.TargetQueue,(e=>e.el===t));return e?e.childrenCount++:(e={el:t,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===f&&this._initListen(e.el,!0),this.TargetQueue.push(e)),this.TargetIndex}}_removeListenerTarget(t){this.TargetQueue.forEach(((e,i)=>{e.el===t&&(e.childrenCount--,e.childrenCount||(this._initListen(e.el,!1),this.TargetQueue.splice(i,1),e=null))}))}_initListen(t,e){this.options.ListenEvents.forEach((i=>$[e?"on":"off"](t,i,this.lazyLoadHandler)))}_initEvent(){this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=(t,e)=>{this.Event.listeners[t]||(this.Event.listeners[t]=[]),this.Event.listeners[t].push(e)},this.$once=(t,e)=>{var i=(...r)=>{this.$off(t,i),e.apply(this,r)};this.$on(t,i)},this.$off=(t,e)=>{if(e)w(this.Event.listeners[t],e);else{if(!this.Event.listeners[t])return;this.Event.listeners[t].length=0}},this.$emit=(t,e,i)=>{this.Event.listeners[t]&&this.Event.listeners[t].forEach((t=>t(e,i)))}}_lazyLoadHandler(){var t=[];this.ListenerQueue.forEach((e=>{e.el&&e.el.parentNode||t.push(e),e.checkInView()&&e.load()})),t.forEach((t=>{w(this.ListenerQueue,t),t.$destroy()}))}_initIntersectionObserver(){m&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach((t=>{this._observer.observe(t.el)})))}_observerHandler(t){t.forEach((t=>{t.isIntersecting&&this.ListenerQueue.forEach((e=>{if(e.el===t.target){if(e.state.loaded)return this._observer.unobserve(e.el);e.load()}}))}))}_elRenderer(t,e,i){if(t.el){var r,{el:s,bindType:n}=t;switch(e){case"loading":r=t.loading;break;case"error":r=t.error;break;default:({src:r}=t)}if(n?s.style[n]='url("'+r+'")':s.getAttribute("src")!==r&&s.setAttribute("src",r),s.setAttribute("lazy",e),this.$emit(e,t,i),this.options.adapter[e]&&this.options.adapter[e](t,this.options),this.options.dispatchEvent){var o=new y(e,{detail:t});s.dispatchEvent(o)}}}_valueFormatter(t){var e,i=t,{loading:r,error:s}=this.options;return null!==(e=t)&&"object"==typeof e&&(t.src||this.options.silent||console.error("Vue Lazyload warning: miss src with "+t),({src:i}=t),r=t.loading||this.options.loading,s=t.error||this.options.error),{src:i,loading:r,error:s}}}}var k=t=>({props:{tag:{type:String,default:"div"}},emits:["show"],render(){return e(this.tag,this.show&&this.$slots.default?this.$slots.default():null)},data:()=>({el:null,state:{loaded:!1},rect:{},show:!1}),mounted(){this.el=this.$el,t.addLazyBox(this),t.lazyLoadHandler()},beforeUnmount(){t.removeComponent(this)},methods:{getRect(){this.rect=this.$el.getBoundingClientRect()},checkInView(){return this.getRect(),v&&this.rect.top<window.innerHeight*t.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*t.options.preLoad&&this.rect.right>0},load(){this.show=!0,this.state.loaded=!0,this.$emit("show",this)},destroy(){return this.$destroy}}}),B={selector:"img"};class W{constructor({el:t,binding:e,vnode:i,lazy:r}){this.el=null,this.vnode=i,this.binding=e,this.options={},this.lazy=r,this._queue=[],this.update({el:t,binding:e})}update({el:t,binding:e}){this.el=t,this.options=Object.assign({},B,e.value),this.getImgs().forEach((t=>{this.lazy.add(t,Object.assign({},this.binding,{value:{src:"dataset"in t?t.dataset.src:t.getAttribute("data-src"),error:("dataset"in t?t.dataset.error:t.getAttribute("data-error"))||this.options.error,loading:("dataset"in t?t.dataset.loading:t.getAttribute("data-loading"))||this.options.loading}}),this.vnode)}))}getImgs(){return Array.from(this.el.querySelectorAll(this.options.selector))}clear(){this.getImgs().forEach((t=>this.lazy.remove(t))),this.vnode=null,this.binding=null,this.lazy=null}}class D{constructor({lazy:t}){this.lazy=t,this._queue=[]}bind(t,e,i){var r=new W({el:t,binding:e,vnode:i,lazy:this.lazy});this._queue.push(r)}update(t,e,i){var r=_(this._queue,(e=>e.el===t));r&&r.update({el:t,binding:e,vnode:i})}unbind(t){var e=_(this._queue,(e=>e.el===t));e&&(e.clear(),w(this._queue,e))}}var N=t=>({props:{src:[String,Object],tag:{type:String,default:"img"}},render(t){return t(this.tag,{attrs:{src:this.renderSrc}},this.$slots.default)},data:()=>({el:null,options:{src:"",error:"",loading:"",attempt:t.options.attempt},state:{loaded:!1,error:!1,attempt:0},rect:{},renderSrc:""}),watch:{src(){this.init(),t.addLazyBox(this),t.lazyLoadHandler()}},created(){this.init(),this.renderSrc=this.options.loading},mounted(){this.el=this.$el,t.addLazyBox(this),t.lazyLoadHandler()},beforeUnmount(){t.removeComponent(this)},methods:{init(){var{src:e,loading:i,error:r}=t._valueFormatter(this.src);this.state.loaded=!1,this.options.src=e,this.options.error=r,this.options.loading=i,this.renderSrc=this.options.loading},getRect(){this.rect=this.$el.getBoundingClientRect()},checkInView(){return this.getRect(),v&&this.rect.top<window.innerHeight*t.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*t.options.preLoad&&this.rect.right>0},load(e=O){if(this.state.attempt>this.options.attempt-1&&this.state.error)return t.options.silent||console.log("VueLazyload log: "+this.options.src+" tried too more than "+this.options.attempt+" times"),void e();var{src:i}=this.options;I({src:i},(({src:t})=>{this.renderSrc=t,this.state.loaded=!0}),(()=>{this.state.attempt++,this.renderSrc=this.options.error,this.state.error=!0}))}}}),V={install(t,e={}){var i=new(S())(e),r=new D({lazy:i});t.config.globalProperties.$Lazyload=i,e.lazyComponent&&t.component("LazyComponent",k(i)),e.lazyImage&&t.component("LazyImage",N(i)),t.directive("lazy",{beforeMount:i.add.bind(i),updated:i.update.bind(i),unmounted:i.remove.bind(i)}),t.directive("lazy-container",{beforeMount:r.bind.bind(r),updated:r.update.bind(r),unmounted:r.unbind.bind(r)})}},q=i({setup(t){window.app&&window.app.use(V,{lazyComponent:!0});const e=g({"zh-CN":{title2:"背景图懒加载",title3:"懒加载模块"},"en-US":{title2:"Lazyload Background Image",title3:"Lazyload Component"}}),i=["https://img.yzcdn.cn/vant/apple-1.jpg","https://img.yzcdn.cn/vant/apple-2.jpg","https://img.yzcdn.cn/vant/apple-3.jpg","https://img.yzcdn.cn/vant/apple-4.jpg"],v=["https://img.yzcdn.cn/vant/apple-5.jpg","https://img.yzcdn.cn/vant/apple-6.jpg"],m=["https://img.yzcdn.cn/vant/apple-8.jpg","https://img.yzcdn.cn/vant/apple-7.jpg"];return(t,g)=>{const f=r("demo-block"),b=r("lazy-component"),y=s("lazy");return l(),n(d,null,[o(f,{title:h(e)("basicUsage")},{default:a((()=>[(l(),n(d,null,c(i,(t=>u(p("img",{key:t},null,512),[[y,t]]))),64))])),_:1},8,["title"]),o(f,{title:h(e)("title2")},{default:a((()=>[(l(),n(d,null,c(v,(t=>u(p("div",{key:t},null,512),[[y,t,"background-image"]]))),64))])),_:1},8,["title"]),o(f,{title:h(e)("title3")},{default:a((()=>[o(b,null,{default:a((()=>[(l(),n(d,null,c(m,(t=>u(p("img",{key:t},null,512),[[y,t]]))),64))])),_:1})])),_:1},8,["title"])],64)}}});export{q as default};
